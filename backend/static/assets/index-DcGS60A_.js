import{r as s,j as e,N as Wt,R as zt,B as Vt,d as Qt,e as Me,f as Gt}from"./react-vendor-DCLtQlHZ.js";import{ao as be,ap as Ht,aq as Ct,ar as Kt,as as kt,at as vt,au as _t,av as Yt,aw as Ye,ax as Jt,ay as et,az as rt,aA as Xt,aB as $t,aC as Zt,aD as Ot,aE as es,aF as Et,aG as ts,aH as ss,aI as as,aJ as ct,aK as Ke,aL as ns,aM as ls,aN as rs,aO as Ft,aP as qe,aQ as is,aR as os,aS as cs,aT as ds,aU as us,aV as tt,aW as ot,aX as ms,aY as jt,aZ as it,a_ as Je,a$ as Dt,b0 as hs,b1 as Tt,b2 as ps,b3 as xs,b4 as gs,b5 as js,b6 as fs,b7 as vs,b8 as ys,b9 as bs,ba as Ns,bb as Cs,bc as Lt,bd as Ss,be as ws,bf as ks,bg as _s,bh as Es,bi as Ds,bj as Ut,bk as Fs,bl as Ts,bm as Ps,bn as As}from"./vendor-kz6cmKr2.js";import{R as nt,L as Rt,C as pt,X as xt,Y as gt,T as lt,a as St,b as ft,P as Mt,c as It,d as qt,B as Pt,e as Nt}from"./charts-vendor-B1etgsqI.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const f of document.querySelectorAll('link[rel="modulepreload"]'))k(f);new MutationObserver(f=>{for(const p of f)if(p.type==="childList")for(const g of p.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&k(g)}).observe(document,{childList:!0,subtree:!0});function i(f){const p={};return f.integrity&&(p.integrity=f.integrity),f.referrerPolicy&&(p.referrerPolicy=f.referrerPolicy),f.crossOrigin==="use-credentials"?p.credentials="include":f.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function k(f){if(f.ep)return;f.ep=!0;const p=i(f);fetch(f.href,p)}})();const Bt=s.createContext(null),dt=()=>{const t=s.useContext(Bt);if(!t)throw new Error("useToast must be used within ToastProvider");return t},zs=({children:t})=>{const[n,i]=s.useState([]),k=s.useCallback((g,j="info",N=3e3)=>{const V=Date.now()+Math.random(),U={id:V,message:g,type:j,duration:N};return i(R=>[...R,U]),N>0&&setTimeout(()=>{f(V)},N),V},[]),f=s.useCallback(g=>{i(j=>j.filter(N=>N.id!==g))},[]),p={success:(g,j)=>k(g,"success",j),error:(g,j)=>k(g,"error",j),warning:(g,j)=>k(g,"warning",j),info:(g,j)=>k(g,"info",j)};return e.jsxs(Bt.Provider,{value:p,children:[t,e.jsx($s,{toasts:n,removeToast:f})]})},$s=({toasts:t,removeToast:n})=>e.jsx("div",{className:"toast-container",children:t.map(i=>e.jsx(Os,{toast:i,onClose:()=>n(i.id)},i.id))}),Os=({toast:t,onClose:n})=>{const i={success:e.jsx(kt,{size:20}),error:e.jsx(Kt,{size:20}),warning:e.jsx(Ct,{size:20}),info:e.jsx(Ht,{size:20})};return e.jsxs("div",{className:`toast toast-${t.type}`,children:[e.jsx("div",{className:"toast-icon",children:i[t.type]}),e.jsx("div",{className:"toast-message",children:t.message}),e.jsx("button",{className:"toast-close",onClick:n,"aria-label":"Close",children:e.jsx(be,{size:16})})]})},Ls="/api/v1",ht=!1;class Us{constructor(n){this.baseURL=n}async request(n,i={}){const k=`${this.baseURL}${n}`,f={headers:{"Content-Type":"application/json",...i.headers},...i};try{const p=await fetch(k,f);if(!p.ok){let j;try{const N=await p.json();j=N.detail||N.message||`HTTP error! status: ${p.status}`}catch{j=`HTTP error! status: ${p.status} - ${p.statusText}`}throw new Error(j)}return p.status===204?null:await p.json()}catch(p){throw p.message==="Failed to fetch"?new Error("Unable to connect to the server."):p.name==="TypeError"&&p.message.includes("fetch")?new Error("Network error. Please check your internet connection and ensure the backend server is accessible."):p}}get(n){return this.request(n,{method:"GET"})}post(n,i){return this.request(n,{method:"POST",body:JSON.stringify(i)})}put(n,i){return this.request(n,{method:"PUT",body:JSON.stringify(i)})}delete(n){return this.request(n,{method:"DELETE"})}async uploadFile(n,i,k={}){const f=`${this.baseURL}${n}`,p=new FormData;p.append("file",i),Object.keys(k).forEach(N=>{p.append(N,k[N])});const g=new AbortController,j=setTimeout(()=>{g.abort()},12e4);try{const N=await fetch(f,{method:"POST",body:p,signal:g.signal});if(clearTimeout(j),!N.ok){let U;try{const R=await N.json();R.detail&&typeof R.detail=="object"?R.detail.errors&&Array.isArray(R.detail.errors)?U=R.detail.errors.join(`
`):U=R.detail.message||JSON.stringify(R.detail):U=R.detail||R.message||`HTTP error! status: ${N.status}`}catch{U=`HTTP error! status: ${N.status} - ${N.statusText}`}throw new Error(U)}return await N.json()}catch(N){throw clearTimeout(j),N.name==="AbortError"?new Error("Upload timeout. The file may be too large or your connection is slow."):N.message==="Failed to fetch"?new Error("Network error. Please check your connection and try again."):N}}async downloadFile(n,i){const k=`${this.baseURL}${n}`;try{const f=await fetch(k,{method:"GET"});if(!f.ok)throw new Error(`HTTP error! status: ${f.status}`);const p=await f.blob(),g=window.URL.createObjectURL(p),j=document.createElement("a");return j.href=g,j.download=i,document.body.appendChild(j),j.click(),document.body.removeChild(j),window.URL.revokeObjectURL(g),!0}catch(f){throw f}}}const b=new Us(Ls),Qe={getAll:(t={})=>{const n=new URLSearchParams(t).toString();return b.get(`/contacts/${n?`?${n}`:""}`)},getById:t=>b.get(`/contacts/${t}`),search:(t,n={})=>{const i=new URLSearchParams({query:t,...n}).toString();return b.get(`/contacts/search?${i}`)},create:t=>b.post("/contacts",t),update:(t,n)=>b.put(`/contacts/${t}`,n),delete:t=>b.delete(`/contacts/${t}`),getFilterOptions:()=>b.get("/contacts/filters/options"),downloadTemplate:()=>b.downloadFile("/contacts/template","contacts_template.xlsx"),bulkUpload:(t,n=!1)=>{const i=`/contacts/bulk-upload${n?"?async_mode=true":""}`;return b.uploadFile(i,t)},getUploadProgress:t=>b.get(`/contacts/upload-progress/${t}`)},We={getAll:(t={})=>{const n=new URLSearchParams(t).toString();return b.get(`/leads/${n?`?${n}`:""}`)},getById:t=>b.get(`/leads/${t}`),getByStatus:(t,n={})=>{const i=new URLSearchParams(n).toString();return b.get(`/leads/status/${t}${i?`?${i}`:""}`)},create:t=>b.post("/leads",t),update:(t,n)=>b.put(`/leads/${t}`,n),delete:t=>b.delete(`/leads/${t}`),getFilterOptions:()=>b.get("/leads/filters/options"),getSummary:()=>b.get("/leads/summary"),downloadTemplate:()=>b.downloadFile("/leads/template","leads_template.xlsx"),bulkUpload:(t,n=!1)=>{const i=`/leads/bulk-upload${n?"?async_mode=true":""}`;return b.uploadFile(i,t)},getUploadProgress:t=>b.get(`/leads/upload-progress/${t}`)},Ie={getAll:(t={})=>{const n=new URLSearchParams(t).toString();return b.get(`/opportunities/${n?`?${n}`:""}`)},getById:t=>b.get(`/opportunities/${t}`),getByStage:(t,n={})=>{const i=new URLSearchParams(n).toString();return b.get(`/opportunities/stage/${t}${i?`?${i}`:""}`)},create:t=>b.post("/opportunities",t),update:(t,n)=>b.put(`/opportunities/${t}`,n),delete:t=>b.delete(`/opportunities/${t}`),getFilterOptions:()=>b.get("/opportunities/filters/options"),downloadTemplate:()=>b.downloadFile("/opportunities/template","opportunities_template.xlsx"),bulkUpload:(t,n=!1)=>{const i=`/opportunities/bulk-upload${n?"?async_mode=true":""}`;return b.uploadFile(i,t)},getUploadProgress:t=>b.get(`/opportunities/upload-progress/${t}`)},Ge={getAll:(t={})=>{const n=new URLSearchParams(t).toString();return b.get(`/accounts/${n?`?${n}`:""}`)},getById:t=>b.get(`/accounts/${t}`),create:t=>b.post("/accounts",t),update:(t,n)=>b.put(`/accounts/${t}`,n),delete:t=>b.delete(`/accounts/${t}`),getFilterOptions:()=>b.get("/accounts/filters/options"),downloadTemplate:()=>b.downloadFile("/accounts/template","accounts_template.xlsx"),bulkUpload:(t,n=!1)=>{const i=`/accounts/bulk-upload${n?"?async_mode=true":""}`;return b.uploadFile(i,t)},getUploadProgress:t=>b.get(`/accounts/upload-progress/${t}`)},Ve={getAll:(t={})=>{const n=new URLSearchParams(t).toString();return b.get(`/tasks/${n?`?${n}`:""}`)},getById:t=>b.get(`/tasks/${t}`),getByStatus:(t,n={})=>{const i=new URLSearchParams(n).toString();return b.get(`/tasks/status/${t}${i?`?${i}`:""}`)},create:t=>b.post("/tasks",t),update:(t,n)=>b.put(`/tasks/${t}`,n),delete:t=>b.delete(`/tasks/${t}`),getFilterOptions:()=>b.get("/tasks/filters/options"),downloadTemplate:()=>b.downloadFile("/tasks/template","tasks_template.xlsx"),bulkUpload:(t,n=!1)=>{const i=`/tasks/bulk-upload${n?"?async_mode=true":""}`;return b.uploadFile(i,t)},getUploadProgress:t=>b.get(`/tasks/upload-progress/${t}`)},Ze={getAll:(t={})=>{const n=new URLSearchParams(t).toString();return b.get(`/calendar/${n?`?${n}`:""}`)},getById:t=>b.get(`/calendar/${t}`),create:t=>b.post("/calendar",t),update:(t,n)=>b.put(`/calendar/${t}`,n),delete:t=>b.delete(`/calendar/${t}`),getFilterOptions:()=>b.get("/calendar/filters/options"),downloadTemplate:()=>b.downloadFile("/calendar/template","calendar_events_template.xlsx"),bulkUpload:(t,n=!1)=>{const i=`/calendar/bulk-upload${n?"?async_mode=true":""}`;return b.uploadFile(i,t)},getUploadProgress:t=>b.get(`/calendar/upload-progress/${t}`)},He={getAll:(t={})=>{const n=new URLSearchParams(t).toString();return b.get(`/email-campaigns/${n?`?${n}`:""}`)},getById:t=>b.get(`/email-campaigns/${t}`),create:t=>b.post("/email-campaigns",t),update:(t,n)=>b.put(`/email-campaigns/${t}`,n),delete:t=>b.delete(`/email-campaigns/${t}`),getFilterOptions:()=>b.get("/email-campaigns/filters/options"),getSummary:()=>b.get("/email-campaigns/summary"),downloadTemplate:()=>b.downloadFile("/email-campaigns/template","email_campaigns_template.xlsx"),bulkUpload:(t,n=!1)=>{const i=`/email-campaigns/bulk-upload${n?"?async_mode=true":""}`;return b.uploadFile(i,t)},getUploadProgress:t=>b.get(`/email-campaigns/upload-progress/${t}`)},Rs={getAll:(t={})=>{const n=new URLSearchParams(t).toString();return b.get(`/reports/${n?`?${n}`:""}`)},getById:t=>b.get(`/reports/${t}`),create:t=>b.post("/reports",t),update:(t,n)=>b.put(`/reports/${t}`,n),delete:t=>b.delete(`/reports/${t}`),analytics:(t={})=>{const n=new URLSearchParams(t).toString();return b.get(`/reports/analytics${n?`?${n}`:""}`)}},wt={getStats:()=>b.get("/dashboard/stats"),getRevenue:()=>b.get("/dashboard/revenue"),getTrends:(t={})=>{const n=new URLSearchParams(t).toString();return b.get(`/dashboard/trends${n?`?${n}`:""}`)}},Ms={getCurrentUser:()=>b.get("/user/me")},Is=({collapsed:t,setCollapsed:n})=>{const[i,k]=s.useState({name:"User",role:"Administrator",avatar_initials:"U"});s.useEffect(()=>{(async()=>{try{const g=await Ms.getCurrentUser();k(g)}catch(g){console.error("Error fetching user data:",g)}})()},[]);const f=[{path:"/",icon:Yt,label:"Dashboard"},{path:"/contacts",icon:Ye,label:"Contacts"},{path:"/leads",icon:Jt,label:"Leads"},{path:"/opportunities",icon:et,label:"Opportunities"},{path:"/accounts",icon:rt,label:"Accounts"},{path:"/tasks",icon:Xt,label:"Tasks"},{path:"/calendar",icon:$t,label:"Calendar"},{path:"/pipeline",icon:Zt,label:"Sales Pipeline"},{path:"/email-campaigns",icon:Ot,label:"Email Campaigns"},{path:"/reports",icon:es,label:"Reports & Analytics"}];return e.jsxs("div",{className:`sidebar ${t?"collapsed":""}`,children:[e.jsxs("div",{className:"sidebar-header",children:[!t&&e.jsx("h1",{className:"sidebar-title",children:"CRM Dashboard"}),e.jsx("button",{className:"collapse-btn",onClick:()=>n(!t),title:t?"Expand sidebar":"Collapse sidebar",children:t?e.jsx(vt,{size:20}):e.jsx(_t,{size:20})})]}),e.jsx("nav",{className:"sidebar-nav",children:f.map(p=>e.jsxs(Wt,{to:p.path,className:({isActive:g})=>`nav-item ${g?"active":""}`,title:t?p.label:"",children:[e.jsx(p.icon,{size:20,className:"nav-icon"}),!t&&e.jsx("span",{className:"nav-label",children:p.label})]},p.path))}),!t&&e.jsx("div",{className:"sidebar-footer",children:e.jsxs("div",{className:"user-info",children:[e.jsx("div",{className:"user-avatar",children:i.avatar_initials}),e.jsxs("div",{className:"user-details",children:[e.jsx("div",{className:"user-name",children:i.name}),e.jsx("div",{className:"user-role",children:i.role})]})]})})]})},qs=()=>{const[t,n]=s.useState("");return e.jsxs("header",{className:"header",children:[e.jsxs("div",{className:"header-search",children:[e.jsx(Et,{size:18,className:"search-icon"}),e.jsx("input",{type:"text",placeholder:"Search contacts, leads, opportunities...",value:t,onChange:i=>n(i.target.value),className:"search-input"})]}),e.jsxs("div",{className:"header-actions",children:[e.jsx("button",{className:"icon-btn",title:"Help",children:e.jsx(ts,{size:20})}),e.jsxs("button",{className:"icon-btn notification-btn",title:"Notifications",children:[e.jsx(ss,{size:20}),e.jsx("span",{className:"notification-badge",children:"3"})]}),e.jsx("button",{className:"icon-btn",title:"Settings",children:e.jsx(as,{size:20})})]})]})},he=({title:t,children:n,className:i="",action:k})=>e.jsxs("div",{className:`card ${i}`,children:[t&&e.jsxs("div",{className:"card-header",children:[e.jsx("h3",{className:"card-title",children:t}),k&&e.jsx("div",{className:"card-action",children:k})]}),e.jsx("div",{className:"card-content",children:n})]}),C=({children:t,variant:n="primary",size:i="medium",icon:k,onClick:f,disabled:p=!1,loading:g=!1,className:j="",type:N="button",style:V={}})=>e.jsx("button",{className:`btn btn-${n} btn-${i} ${g?"btn-loading":""} ${j}`,onClick:f,disabled:p||g,type:N,style:V,children:g?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"btn-spinner"}),t]}):e.jsxs(e.Fragment,{children:[k&&e.jsx("span",{className:"btn-icon",children:k}),t]})}),Xe=({size:t="medium",fullPage:n=!1,text:i=""})=>{const k=`loader-${t}`;return n?e.jsx("div",{className:"loader-fullpage",children:e.jsxs("div",{className:"loader-content",children:[e.jsx("div",{className:`loader ${k}`,children:e.jsx("div",{className:"loader-spinner"})}),i&&e.jsx("p",{className:"loader-text",children:i})]})}):e.jsxs("div",{className:"loader-container",children:[e.jsx("div",{className:`loader ${k}`,children:e.jsx("div",{className:"loader-spinner"})}),i&&e.jsx("p",{className:"loader-text",children:i})]})},Bs=()=>e.jsxs("div",{className:"dashboard-skeleton",children:[e.jsx("div",{className:"skeleton-stats-grid",children:[1,2,3,4].map(t=>e.jsx("div",{className:"skeleton skeleton-stat-card"},t))}),e.jsxs("div",{className:"skeleton-charts-grid",children:[e.jsx("div",{className:"skeleton skeleton-chart"}),e.jsx("div",{className:"skeleton skeleton-chart"})]}),e.jsxs("div",{className:"skeleton-tables-grid",children:[e.jsx("div",{className:"skeleton skeleton-table"}),e.jsx("div",{className:"skeleton skeleton-table"})]})]}),yt=({count:t=6,size:n="medium"})=>e.jsx("div",{className:"card-list-skeleton",children:Array.from({length:t}).map((i,k)=>e.jsx("div",{className:`skeleton skeleton-card ${n}`},k))}),Ws=()=>e.jsxs("div",{className:"calendar-skeleton",children:[e.jsxs("div",{className:"skeleton-calendar-header",children:[e.jsx("div",{className:"skeleton skeleton-calendar-title"}),e.jsxs("div",{className:"skeleton-calendar-controls",children:[e.jsx("div",{className:"skeleton skeleton-calendar-button"}),e.jsx("div",{className:"skeleton skeleton-calendar-button"})]})]}),e.jsx("div",{className:"skeleton skeleton-calendar-grid"}),e.jsx("div",{className:"skeleton skeleton-events-list"})]}),Vs=()=>e.jsx("div",{className:"pipeline-skeleton",children:e.jsx("div",{className:"skeleton-pipeline-columns",children:[1,2,3,4,5].map(t=>e.jsxs("div",{className:"skeleton-pipeline-column",children:[e.jsx("div",{className:"skeleton skeleton-pipeline-column-header"}),[1,2,3].map(n=>e.jsx("div",{className:"skeleton skeleton-pipeline-deal"},n))]},t))})}),Qs=()=>e.jsxs("div",{className:"reports-skeleton",children:[e.jsxs("div",{className:"skeleton-report-header",children:[e.jsx("div",{className:"skeleton skeleton-report-title"}),e.jsx("div",{className:"skeleton skeleton-export-button"})]}),e.jsx("div",{className:"skeleton-metrics-grid",children:[1,2,3,4].map(t=>e.jsx("div",{className:"skeleton skeleton-metric"},t))}),e.jsxs("div",{className:"skeleton-charts-grid",children:[e.jsx("div",{className:"skeleton skeleton-chart"}),e.jsx("div",{className:"skeleton skeleton-chart"})]}),e.jsx("div",{className:"skeleton skeleton-chart"})]}),Gs=()=>e.jsx("div",{className:"tasks-board-skeleton",children:["To Do","In Progress","Completed"].map((t,n)=>e.jsxs("div",{className:"skeleton-task-column",children:[e.jsx("div",{className:"skeleton skeleton-task-column-header"}),[1,2,3,4].map(i=>e.jsx("div",{className:"skeleton skeleton-task-card-simple"},i))]},n))}),Hs=()=>e.jsx("div",{className:"card-list-skeleton",children:Array.from({length:6}).map((t,n)=>e.jsx("div",{className:"skeleton skeleton-card large"},n))}),Be=({value:t,duration:n=1e3,prefix:i="",suffix:k="",decimals:f=0,separator:p=","})=>{const[g,j]=s.useState(0),[N,V]=s.useState(!1),U=s.useRef(null),R=s.useRef(!1);s.useEffect(()=>{const v=new IntersectionObserver(([x])=>{x.isIntersecting&&!R.current&&(V(!0),R.current=!0)},{threshold:.1});return U.current&&v.observe(U.current),()=>{U.current&&v.unobserve(U.current)}},[]),s.useEffect(()=>{if(!N)return;const v=typeof t=="number"?t:parseFloat(String(t).replace(/[^0-9.-]/g,""))||0,x=0,_=Date.now(),G=()=>{const T=Date.now(),O=Math.min((T-_)/n,1),X=1-Math.pow(1-O,4),ie=x+(v-x)*X;j(ie),O<1?requestAnimationFrame(G):j(v)};G()},[t,n,N]);const $=v=>{const _=(f>0?v.toFixed(f):Math.round(v)).toString().split(".");return _[0]=_[0].replace(/\B(?=(\d{3})+(?!\d))/g,p),_.join(".")};return e.jsxs("span",{ref:U,children:[i,$(g),k]})},Ks=()=>{const[t,n]=s.useState(null),[i,k]=s.useState([]),[f,p]=s.useState(!0),[g,j]=s.useState(null);s.useEffect(()=>{N()},[]);const N=async()=>{try{p(!0);const[v,x]=await Promise.all([wt.getStats(),wt.getTrends({months:6})]);n(v),k(x?.series||[]),j(null)}catch(v){console.error("Error fetching dashboard stats:",v),j("Failed to load dashboard data. Please try again.")}finally{p(!1)}},V=i,U=t?.opportunities_by_stage?.map((v,x)=>({name:v.stage,value:v.total_value,count:v.count,color:["#3b82f6","#8b5cf6","#10b981","#f59e0b","#ef4444"][x%5]}))||[],R=t?[{title:"Total Contacts",value:t.summary.total_contacts.toString(),change:"+12.5%",icon:Ye,positive:!0,color:"#10b981"},{title:"Total Leads",value:t.summary.total_leads.toString(),change:"+8.2%",icon:et,positive:!0,color:"#3b82f6"},{title:"Pipeline Value",value:`$${Math.round(t.summary.total_opportunity_value).toLocaleString()}`,change:"-2.1%",icon:ct,positive:!1,color:"#f59e0b"},{title:"Opportunities",value:t.summary.total_opportunities.toString(),change:"+18.7%",icon:Ke,positive:!0,color:"#8b5cf6"}]:[];t?.recent_activities?.contacts;const $=(t?.recent_opportunities||[]).map(v=>({id:v.id,company:v.company||"N/A",contact:v.contact||"N/A",value:`$${Math.round(v.value||0).toLocaleString()}`,stage:v.stage||"N/A",probability:`${v.probability||0}%`}));return f?e.jsxs("div",{className:"dashboard",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{className:"page-title",children:"Dashboard Overview"}),e.jsx("p",{className:"page-subtitle",children:"Welcome back! Here's what's happening with your sales today."})]}),e.jsx(Bs,{})]}):g?e.jsxs("div",{className:"dashboard",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{className:"page-title",children:"Dashboard Overview"}),e.jsx("p",{className:"page-subtitle",children:"Welcome back! Here's what's happening with your sales today."})]}),e.jsx(he,{children:e.jsxs("div",{className:"error-state-container",children:[e.jsx("div",{className:"error-state-message",children:g}),e.jsx(C,{onClick:N,className:"error-state-retry-button",children:"Retry"})]})})]}):e.jsxs("div",{className:"dashboard",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{className:"page-title",children:"Dashboard Overview"}),e.jsx("p",{className:"page-subtitle",children:"Welcome back! Here's what's happening with your sales today."})]}),f?e.jsx(he,{children:e.jsx("div",{style:{padding:"40px",textAlign:"center"},children:"Loading dashboard..."})}):g?e.jsx(he,{children:e.jsxs("div",{className:"error-state-container",children:[e.jsx("div",{className:"error-state-message",children:g}),e.jsx(C,{onClick:N,className:"error-state-retry-button",children:"Retry"})]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"stats-grid",children:R.map((v,x)=>e.jsx(he,{className:"stat-card",children:e.jsxs("div",{className:"stat-content",children:[e.jsxs("div",{className:"stat-header",children:[e.jsx("div",{className:"stat-icon",style:{background:`${v.color}20`,color:v.color},children:e.jsx(v.icon,{size:24})}),e.jsxs("div",{className:`stat-change ${v.positive?"positive":"negative"}`,children:[v.positive?e.jsx(ns,{size:16}):e.jsx(ls,{size:16}),v.change]})]}),e.jsxs("div",{className:"stat-info",children:[e.jsx("h3",{className:"stat-value",children:v.title==="Pipeline Value"?e.jsxs(e.Fragment,{children:["$",e.jsx(Be,{value:Math.round(t.summary.total_opportunity_value),duration:1200,separator:","})]}):e.jsx(Be,{value:parseInt(v.value.replace(/[^0-9]/g,""))||0,duration:1200,separator:","})}),e.jsx("p",{className:"stat-title",children:v.title})]})]})},x))}),e.jsxs("div",{className:"charts-row",children:[e.jsx(he,{title:"Revenue & Leads Trend",className:"chart-card",children:e.jsx(nt,{width:"100%",height:300,children:e.jsxs(Rt,{data:V,children:[e.jsx(pt,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),e.jsx(xt,{dataKey:"month",stroke:"#64748b"}),e.jsx(gt,{stroke:"#64748b"}),e.jsx(lt,{contentStyle:{background:"#fff",border:"1px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"}}),e.jsx(St,{}),e.jsx(ft,{type:"monotone",dataKey:"revenue",stroke:"#3b82f6",strokeWidth:3,name:"Revenue ($)"}),e.jsx(ft,{type:"monotone",dataKey:"leads",stroke:"#8b5cf6",strokeWidth:3,name:"Leads"})]})})}),e.jsx(he,{title:"Pipeline Distribution",className:"chart-card",children:e.jsx(nt,{width:"100%",height:300,children:e.jsxs(Mt,{children:[e.jsx(It,{data:U,cx:"50%",cy:"50%",labelLine:!1,label:({name:v,percent:x})=>`${v} ${(x*100).toFixed(0)}%`,outerRadius:100,fill:"#8884d8",dataKey:"value",children:U.map((v,x)=>e.jsx(qt,{fill:v.color},`cell-${x}`))}),e.jsx(lt,{})]})})})]}),e.jsx(he,{title:"Recent Opportunities",children:e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"data-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Company"}),e.jsx("th",{children:"Contact"}),e.jsx("th",{children:"Value"}),e.jsx("th",{children:"Stage"}),e.jsx("th",{children:"Probability"})]})}),e.jsx("tbody",{children:$.map(v=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-semibold",children:v.company}),e.jsx("td",{children:v.contact}),e.jsx("td",{className:"font-semibold text-success",children:v.value}),e.jsx("td",{children:e.jsx("span",{className:`badge badge-${v.stage.toLowerCase().replace(" ","-")}`,children:v.stage})}),e.jsx("td",{children:v.probability})]},v.id))})]})})})]})]})},st=({isOpen:t,onClose:n,onUpload:i,onDownloadTemplate:k,onGetProgress:f,title:p="Upload Excel File",entityName:g="records"})=>{const[j,N]=s.useState(null),[V,U]=s.useState(!1),[R,$]=s.useState(!1),[v,x]=s.useState(null),[_,G]=s.useState(null),[T,O]=s.useState(!1),[X,ie]=s.useState(null),[d,Q]=s.useState(null),[F,E]=s.useState(null),[W,te]=s.useState(null),[I,y]=s.useState(""),[L,H]=s.useState(!1),[M,Y]=s.useState(0),[Z,re]=s.useState(0),[z,oe]=s.useState(!1),[ee,le]=s.useState(null),[u,A]=s.useState(0),[we,ae]=s.useState(0),w=s.useRef(null),ne=s.useRef(null),D=s.useRef(!1),ce=s.useRef(!1),se=s.useRef(null),xe=s.useRef(null),de=s.useRef(null);s.useEffect(()=>(z&&ee?de.current=setInterval(()=>{ae(Date.now()-ee)},1e3):(de.current&&(clearInterval(de.current),de.current=null),ae(0)),()=>{de.current&&clearInterval(de.current)}),[z,ee]),s.useEffect(()=>(t||(q(),ze()),()=>{q(),se.current&&se.current.abort()}),[t]);const ze=()=>{$(!1),x(null),G(null),Q(null),O(!1),ie(null),Y(0),re(0),oe(!1),le(null),A(0),ae(0),D.current=!1,ce.current=!1,xe.current=null,de.current&&(clearInterval(de.current),de.current=null),se.current&&(se.current.abort(),se.current=null)},q=()=>{ne.current&&(clearInterval(ne.current),ne.current=null),D.current=!1},je=async a=>{if(!(!f||!a)&&!ce.current&&!D.current){D.current=!0;try{const r=await f(a);Q(r),re(0),(r.status==="completed"||r.status==="failed")&&(q(),$(!1),te(Date.now()),r.status==="completed"?(G({success_count:r.success_count||0,failed_count:r.failed_count||0,failed_records:r.errors||[]}),N(null),w.current&&(w.current.value=""),r.failed_count===0&&setTimeout(()=>{ge()},2e3)):r.status==="failed"&&x(r.error_message||"Upload failed. Please try again."))}catch(r){console.error("Error polling progress:",r),re(P=>P+1),Z>=4?(q(),$(!1),x("Lost connection to upload progress. The upload may still be processing in the background.")):setTimeout(()=>je(a),1e3)}finally{D.current=!1}}},Ne=()=>{z||(oe(!0),ce.current=!0,le(Date.now()),xe.current=Date.now(),q())},$e=()=>{if(z&&X){if(xe.current){const a=Date.now()-xe.current;A(r=>r+a),xe.current=null}oe(!1),ce.current=!1,le(null),ne.current=setInterval(()=>{je(X)},500),je(X)}},ke=()=>{window.confirm("Are you sure you want to cancel this upload? This action cannot be undone.")&&(q(),ze())};if(!t)return null;const Ae=a=>{a.preventDefault(),U(!0)},Ee=()=>{U(!1)},Pe=a=>{a.preventDefault(),U(!1);const r=a.dataTransfer.files[0];if(r&&(r.name.endsWith(".xlsx")||r.name.endsWith(".xls"))){if(r.size>52428800){x(`File is too large (${Fe(r.size)}). Maximum size is 50 MB.`);return}N(r),x(null),G(null)}else x("Please select a valid Excel file (.xlsx or .xls)")},_e=a=>{const r=a.target.files[0];if(r){if(r.size>52428800){x(`File is too large (${Fe(r.size)}). Maximum size is 50 MB.`);return}const J=[".xlsx",".xls"],ue=r.name.toLowerCase();if(!J.some(Ue=>ue.endsWith(Ue))){x("Invalid file type. Please upload an Excel file (.xlsx or .xls)");return}N(r),x(null),G(null)}},fe=()=>{N(null),x(null),G(null),w.current&&(w.current.value="")},ve=async()=>{if(!j){x("Please select a file to upload");return}$(!0),x(null),G(null),E(Date.now()),te(null),re(0),q(),se.current=new AbortController;try{const a=j.size>2097152;Q({status:"processing",processed:0,total:0,progress_percentage:0});const r=await i(j,a);if(r&&r.async&&r.task_id)O(!0),ie(r.task_id),Q({status:"processing",processed:0,total:0,progress_percentage:0}),await new Promise(P=>setTimeout(P,500)),ne.current=setInterval(()=>{je(r.task_id)},500),je(r.task_id);else if(r)$(!1),te(Date.now()),G(r),N(null),w.current&&(w.current.value=""),r.failed_count===0&&setTimeout(()=>{ge()},2e3);else throw new Error("No response received from server")}catch(a){$(!1),te(Date.now());let r="Failed to upload file. Please try again.";a.message.includes("Connection error")||a.message.includes("refresh your token")?r="Database connection error. Please refresh the page and try again. If the problem persists, contact your administrator.":a.message.includes("Authentication error")?r="Authentication error. Please refresh the page and log in again.":a.message.includes("token")||a.message.includes("expired")||a.message.includes("unauthorized")?r="Session expired. Please refresh the page and try again.":a.message.includes("network")||a.message.includes("fetch")?r="Network error. Please check your connection and try again.":a.message.includes("timeout")?r="Upload timeout. The file may be too large or your connection is slow.":a.message&&(r=a.message),x(r),Y(P=>P+1)}finally{se.current=null}},De=async()=>{try{await k()}catch{x("Failed to download template. Please try again.")}},Fe=a=>a<1024?a+" B":a<1024*1024?(a/1024).toFixed(1)+" KB":(a/(1024*1024)).toFixed(1)+" MB",Oe=(a,r)=>{if(!a||!r)return null;const P=(r-a-u)/1e3;if(P<60)return`${P.toFixed(1)}s`;const J=Math.floor(P/60),ue=(P%60).toFixed(1);return`${J}m ${ue}s`},pe=a=>{if(!a)return null;const r=a/1e3;if(r<60)return`${r.toFixed(0)}s`;const P=Math.floor(r/60),J=Math.floor(r%60);return`${P}m ${J}s`},ge=()=>{R&&!z||R&&z&&!window.confirm("Upload is paused. Are you sure you want to close? The upload will continue in the background.")||(q(),N(null),x(null),G(null),Q(null),O(!1),ie(null),E(null),te(null),y(""),H(!1),Y(0),re(0),oe(!1),ce.current=!1,le(null),A(0),w.current&&(w.current.value=""),se.current&&(se.current.abort(),se.current=null),n())},Ce=()=>{if(!_?.failed_records)return[];if(!I.trim())return _.failed_records;const a=I.toLowerCase();return _.failed_records.filter(r=>r.error?.toLowerCase().includes(a)||String(r.row).includes(a)||r.data&&JSON.stringify(r.data).toLowerCase().includes(a))},Le=()=>{if(!_?.failed_records||_.failed_records.length===0)return;const r=[["Row","Error","Data"].join(","),..._.failed_records.map(Te=>{const Ue=Te.row||"N/A",h=(Te.error||"").replace(/"/g,'""'),l=Te.data?JSON.stringify(Te.data).replace(/"/g,'""'):"";return`${Ue},"${h}","${l}"`})].join(`
`),P=new Blob([r],{type:"text/csv;charset=utf-8;"}),J=document.createElement("a"),ue=URL.createObjectURL(P);J.setAttribute("href",ue),J.setAttribute("download",`failed_${g}_${new Date().toISOString().split("T")[0]}.csv`),J.style.visibility="hidden",document.body.appendChild(J),J.click(),document.body.removeChild(J)};return e.jsx("div",{className:"excel-upload-modal-overlay",onClick:ge,children:e.jsxs("div",{className:"excel-upload-modal",onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:"excel-upload-modal-header",children:[e.jsx("h2",{children:p}),e.jsx("button",{className:"excel-upload-close-btn",onClick:ge,disabled:R,children:e.jsx(be,{size:24})})]}),e.jsxs("div",{className:"excel-upload-content",children:[e.jsxs("div",{className:"excel-upload-section",children:[e.jsxs("h3",{children:[e.jsx(rs,{size:18}),"Step 1: Download Template"]}),e.jsx("p",{children:"Download the Excel template with the correct format and column structure. Fill in your data following the example row provided."}),e.jsxs("button",{className:"excel-download-template-btn",onClick:De,disabled:R,children:[e.jsx(Ft,{size:18}),"Download Template"]})]}),e.jsxs("div",{className:"excel-upload-section",children:[e.jsxs("h3",{children:[e.jsx(qe,{size:18}),"Step 2: Upload Your File"]}),e.jsx("p",{children:"Upload your completed Excel file. The system will validate the data format and show any errors before importing."}),j?e.jsxs("div",{className:"excel-upload-selected-file",children:[e.jsx("div",{className:"excel-upload-file-icon",children:e.jsx(Ft,{size:20})}),e.jsxs("div",{className:"excel-upload-file-info",children:[e.jsx("div",{className:"excel-upload-file-name",children:j.name}),e.jsx("div",{className:"excel-upload-file-size",children:Fe(j.size)})]}),e.jsx("button",{className:"excel-upload-remove-btn",onClick:fe,disabled:R,children:e.jsx(be,{size:20})})]}):e.jsxs("div",{className:`excel-upload-dropzone ${V?"drag-over":""}`,onDragOver:Ae,onDragLeave:Ee,onDrop:Pe,onClick:()=>w.current?.click(),children:[e.jsx(qe,{className:"excel-upload-icon"}),e.jsx("p",{children:"Drag and drop your Excel file here"}),e.jsx("p",{children:"or"}),e.jsx("small",{children:"Click to browse files (.xlsx, .xls)"}),e.jsx("input",{ref:w,type:"file",accept:".xlsx,.xls",onChange:_e,className:"excel-upload-file-input"})]})]}),v&&e.jsxs("div",{className:"excel-upload-error",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Error:"})," ",v]}),M<3&&j&&e.jsx("button",{className:"retry-upload-btn",onClick:ve,disabled:R,children:"Retry Upload"})]}),M>0&&e.jsxs("small",{style:{display:"block",marginTop:"8px",opacity:.7},children:["Attempt ",M+1," of 3"]})]}),R&&d&&e.jsxs("div",{className:`excel-upload-progress ${z?"paused":""}`,children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[e.jsx("h4",{style:{margin:0},children:z?"⏸ Upload Paused":"Processing Upload..."}),e.jsx("div",{className:"upload-control-buttons",children:z?e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"resume-upload-btn",onClick:$e,title:"Resume upload",children:[e.jsx("span",{children:"▶"})," Resume"]}),e.jsxs("button",{className:"cancel-upload-btn",onClick:ke,title:"Cancel upload",children:[e.jsx(be,{size:14})," Cancel"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"pause-upload-btn",onClick:Ne,title:"Pause upload",children:[e.jsx("span",{children:"⏸"})," Pause"]}),e.jsxs("button",{className:"cancel-upload-btn",onClick:ke,title:"Cancel upload",children:[e.jsx(be,{size:14})," Cancel"]})]})})]}),e.jsx("div",{className:"progress-bar-container",children:e.jsx("div",{className:`progress-bar ${z?"paused":""}`,style:{width:`${d.progress_percentage||0}%`}})}),e.jsxs("p",{children:[d.processed||0," of ",d.total||0," records processed (",d.progress_percentage?.toFixed(1)||0,"%)"]}),d.success_count>0&&e.jsxs("p",{style:{color:"#10b981"},children:["✓ ",d.success_count," successful"]}),d.failed_count>0&&e.jsxs("p",{style:{color:"#dc2626"},children:["✗ ",d.failed_count," failed"]}),z&&ee&&e.jsxs("p",{style:{color:"#f59e0b",fontSize:"13px",marginTop:"8px"},children:["⏸ Paused for ",pe(Date.now()-ee),u>0&&` (Total paused: ${pe(u)})`]})]}),_&&e.jsxs("div",{className:"excel-upload-success",children:[e.jsxs("h4",{children:[e.jsx(kt,{size:20,style:{display:"inline",marginRight:"8px"}}),"Upload Complete"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Successfully imported:"})," ",_.success_count," ",g]}),F&&W&&e.jsxs("p",{style:{color:"#64748b",fontSize:"14px"},children:[e.jsx("strong",{children:"Time taken:"})," ",Oe(F,W)]}),_.failed_count>0&&e.jsxs("div",{className:"excel-upload-success-details",children:[e.jsxs("p",{style:{color:"#dc2626",fontWeight:600,fontSize:"15px"},children:[e.jsx(Ct,{size:16,style:{display:"inline",marginRight:"4px"}}),e.jsx("strong",{children:"Failed:"})," ",_.failed_count," ",g]}),_.failed_records&&_.failed_records.length>0&&e.jsxs("div",{className:"excel-upload-error-section",children:[e.jsxs("div",{className:"error-actions-bar",children:[e.jsxs("div",{className:"error-search-box",children:[e.jsx(Et,{size:16}),e.jsx("input",{type:"text",placeholder:"Search errors by row, message, or data...",value:I,onChange:a=>y(a.target.value),className:"error-search-input"}),I&&e.jsx("button",{className:"error-search-clear",onClick:()=>y(""),children:e.jsx(be,{size:14})})]}),e.jsxs("button",{className:"export-errors-btn",onClick:Le,title:"Export failed records to CSV",children:[e.jsx(is,{size:16}),"Export Errors"]})]}),e.jsx("div",{className:"error-stats",children:e.jsxs("span",{children:["Showing ",Ce().length," of ",_.failed_records.length," errors"]})}),e.jsx("div",{className:`excel-upload-failed-records ${L?"show-all":""}`,children:Ce().length>0?Ce().map((a,r)=>e.jsxs("div",{className:"excel-upload-failed-record",children:[e.jsxs("div",{className:"failed-record-header",children:[e.jsxs("span",{className:"failed-record-row",children:["Row ",a.row]}),a.data&&e.jsxs("span",{className:"failed-record-data-preview",children:[typeof a.data=="object"?Object.entries(a.data).slice(0,2).map(([P,J])=>`${P}: ${J}`).join(", "):String(a.data).substring(0,50),typeof a.data=="object"&&Object.keys(a.data).length>2||typeof a.data=="string"&&a.data.length>50?"...":""]})]}),e.jsxs("div",{className:"failed-record-error",children:[e.jsx(Ct,{size:14}),e.jsx("span",{children:a.error})]}),a.data&&e.jsxs("details",{className:"failed-record-details",children:[e.jsx("summary",{children:"View full data"}),e.jsx("pre",{className:"failed-record-data",children:JSON.stringify(a.data,null,2)})]})]},r)):e.jsx("div",{className:"no-errors-found",children:"No errors match your search query"})}),_.failed_records.length>5&&!I&&e.jsx("button",{className:"toggle-errors-btn",onClick:()=>H(!L),children:L?"Show Less":`Show All ${_.failed_records.length} Errors`})]})]})]})]}),e.jsxs("div",{className:"excel-upload-actions",children:[e.jsx("button",{className:"excel-upload-cancel-btn",onClick:ge,disabled:R,children:_?"Close":"Cancel"}),!_&&e.jsx("button",{className:"excel-upload-submit-btn",onClick:ve,disabled:!j||R,children:R?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner"}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(qe,{size:18}),"Upload File"]})})]})]})})},ut=({isOpen:t,onClose:n,onConfirm:i,title:k="Confirm Action",message:f="Are you sure you want to proceed?",confirmText:p="Confirm",cancelText:g="Cancel",type:j="danger",loading:N=!1})=>{if(!t)return null;const V=()=>{i()},U=R=>{R.target===R.currentTarget&&!N&&n()};return e.jsx("div",{className:"confirmation-modal-overlay",onClick:U,children:e.jsxs("div",{className:"confirmation-modal",children:[e.jsxs("div",{className:"confirmation-modal-header",children:[e.jsx("h2",{children:k}),e.jsx("button",{className:"confirmation-modal-close",onClick:n,disabled:N,"aria-label":"Close",children:e.jsx(be,{size:20})})]}),e.jsxs("div",{className:"confirmation-modal-body",children:[e.jsx("div",{className:`confirmation-modal-icon confirmation-modal-icon-${j}`,children:e.jsx(os,{size:48})}),e.jsx("p",{className:"confirmation-modal-message",children:f})]}),e.jsxs("div",{className:"confirmation-modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:n,disabled:N,children:g}),e.jsx("button",{className:`btn btn-${j}`,onClick:V,disabled:N,children:N?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-small"}),"Processing..."]}):p})]})]})})},mt=({isOpen:t,onClose:n,onApply:i,filters:k={},filterConfigs:f=[]})=>{const[p,g]=s.useState(k),[j,N]=s.useState({}),[V,U]=s.useState({}),[R,$]=s.useState({}),[v,x]=s.useState({});s.useEffect(()=>{g(k)},[k]),s.useEffect(()=>{if(t){_();const I={};f.forEach(y=>{I[y.key]=!0}),N(I)}},[t]);const _=async()=>{const I=f.map(async y=>y.loadOptions&&!R[y.key]?G(y.key,y.loadOptions):(y.options&&$(L=>({...L,[y.key]:y.options})),Promise.resolve()));await Promise.all(I)},G=async(I,y)=>{U(L=>({...L,[I]:!0}));try{const L=await y();$(H=>({...H,[I]:L}))}catch(L){console.error(`Error loading options for ${I}:`,L)}finally{U(L=>({...L,[I]:!1}))}},T=(I,y)=>{g(L=>({...L,[I]:y}))},O=(I,y)=>{const L=p[I]||[],H=L.includes(y)?L.filter(M=>M!==y):[...L,y];T(I,H.length>0?H:void 0)},X=I=>{N(y=>({...y,[I]:!y[I]}))},ie=()=>{const I=Object.entries(p).reduce((y,[L,H])=>(H!=null&&H!==""&&(!Array.isArray(H)||H.length>0)&&(y[L]=H),y),{});i(I),n()},d=()=>{g({}),x({}),i({})},Q=I=>{const y={...p};delete y[I],g(y)},F=()=>Object.entries(p).filter(([I,y])=>Array.isArray(y)?y.length>0:y!=null&&y!=="").length,E=(I,y)=>{const L=v[I];return L?y.filter(H=>H.toLowerCase().includes(L.toLowerCase())):y},W=I=>{const{key:y,label:L,type:H,placeholder:M,icon:Y}=I,Z=p[y],re=R[y]||[],z=V[y],oe=j[y]!==!1;switch(H){case"select":return e.jsxs("div",{className:"mui-filter-field",children:[e.jsxs("label",{className:"mui-filter-label",children:[Y&&e.jsx("span",{className:"mui-filter-icon",children:Y}),L]}),e.jsxs("select",{className:"mui-filter-select",value:Z||"",onChange:u=>T(y,u.target.value||void 0),disabled:z,children:[e.jsxs("option",{value:"",children:["All ",L]}),z?e.jsx("option",{disabled:!0,children:"Loading..."}):re.map(u=>e.jsx("option",{value:u,children:u},u))]})]},y);case"multiselect":const ee=(Z||[]).length,le=E(y,re);return e.jsxs("div",{className:"mui-filter-field",children:[e.jsxs("div",{className:"mui-filter-header",onClick:()=>X(y),children:[e.jsxs("div",{className:"mui-filter-header-left",children:[oe?e.jsx(cs,{size:18}):e.jsx(vt,{size:18}),Y&&e.jsx("span",{className:"mui-filter-icon",children:Y}),e.jsx("label",{className:"mui-filter-label",children:L})]}),ee>0&&e.jsx("span",{className:"mui-filter-chip",children:ee})]}),oe&&e.jsxs("div",{className:"mui-filter-content",children:[re.length>5&&e.jsxs("div",{className:"mui-filter-search",children:[e.jsx(Et,{size:16}),e.jsx("input",{type:"text",placeholder:`Search ${L.toLowerCase()}...`,value:v[y]||"",onChange:u=>x(A=>({...A,[y]:u.target.value})),className:"mui-search-input",onClick:u=>u.stopPropagation()})]}),e.jsx("div",{className:"mui-filter-options",children:z?e.jsxs("div",{className:"mui-filter-loading",children:[e.jsx("div",{className:"mui-spinner"}),"Loading options..."]}):le.length===0?e.jsx("div",{className:"mui-filter-empty",children:v[y]?"No matches found":"No options available"}):e.jsx(e.Fragment,{children:le.map(u=>e.jsxs("label",{className:"mui-checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:(Z||[]).includes(u),onChange:()=>O(y,u),className:"mui-checkbox"}),e.jsx("span",{className:"mui-checkbox-text",children:u}),(Z||[]).includes(u)&&e.jsx("span",{className:"mui-checkbox-check",children:"✓"})]},u))})}),ee>0&&e.jsx("div",{className:"mui-filter-actions",children:e.jsx("button",{className:"mui-clear-btn",onClick:()=>Q(y),children:"Clear"})})]})]},y);case"range":return e.jsxs("div",{className:"mui-filter-field",children:[e.jsxs("label",{className:"mui-filter-label",children:[Y&&e.jsx("span",{className:"mui-filter-icon",children:Y}),L]}),e.jsxs("div",{className:"mui-filter-range",children:[e.jsx("input",{type:"number",className:"mui-filter-input",placeholder:"Min",value:Z?.min||"",onChange:u=>T(y,{...Z||{},min:u.target.value||void 0})}),e.jsx("span",{className:"mui-range-separator",children:"—"}),e.jsx("input",{type:"number",className:"mui-filter-input",placeholder:"Max",value:Z?.max||"",onChange:u=>T(y,{...Z||{},max:u.target.value||void 0})})]})]},y);case"date":return e.jsxs("div",{className:"mui-filter-field",children:[e.jsxs("label",{className:"mui-filter-label",children:[Y&&e.jsx("span",{className:"mui-filter-icon",children:Y}),L]}),e.jsxs("div",{className:"mui-filter-date-range",children:[e.jsx("input",{type:"date",className:"mui-filter-input",value:Z?.from||"",onChange:u=>T(y,{...Z||{},from:u.target.value||void 0})}),e.jsx("span",{className:"mui-range-separator",children:"to"}),e.jsx("input",{type:"date",className:"mui-filter-input",value:Z?.to||"",onChange:u=>T(y,{...Z||{},to:u.target.value||void 0})})]})]},y);case"text":return e.jsxs("div",{className:"mui-filter-field",children:[e.jsxs("label",{className:"mui-filter-label",children:[Y&&e.jsx("span",{className:"mui-filter-icon",children:Y}),L]}),e.jsx("input",{type:"text",className:"mui-filter-input",placeholder:M||`Enter ${L.toLowerCase()}...`,value:Z||"",onChange:u=>T(y,u.target.value||void 0)})]},y);default:return null}};if(!t)return null;const te=F();return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mui-filter-overlay",onClick:n}),e.jsxs("div",{className:"mui-filter-panel",children:[e.jsxs("div",{className:"mui-filter-panel-header",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"mui-filter-panel-title",children:"Filters"}),te>0&&e.jsxs("span",{className:"mui-active-badge",children:[te," active"]})]}),e.jsx("button",{className:"mui-close-btn",onClick:n,"aria-label":"Close filters",children:e.jsx(be,{size:20})})]}),e.jsx("div",{className:"mui-filter-panel-content",children:f.map(I=>W(I))}),e.jsxs("div",{className:"mui-filter-panel-footer",children:[e.jsx(C,{variant:"outline",onClick:d,disabled:te===0,children:"Clear All"}),e.jsx(C,{onClick:ie,children:"Apply Filters"})]})]})]})},at=({currentPage:t,totalPages:n,pageSize:i,total:k,onPageChange:f,onPageSizeChange:p})=>{const g=[10,20,50,100],j=$=>{$>=1&&$<=n&&f($)},N=()=>{const $=[];if(n<=5)for(let x=1;x<=n;x++)$.push(x);else{$.push(1);let x=Math.max(2,t-1),_=Math.min(n-1,t+1);t<=3?_=4:t>=n-2&&(x=n-3),x>2&&$.push("...");for(let G=x;G<=_;G++)$.push(G);_<n-1&&$.push("..."),$.push(n)}return $},V=k||0,U=V===0?0:(t-1)*i+1,R=Math.min(t*i,V);return e.jsxs("div",{className:"pagination-container",children:[e.jsxs("div",{className:"pagination-info",children:["Showing ",U," to ",R," of ",V," entries"]}),e.jsxs("div",{className:"pagination-controls",children:[e.jsxs("div",{className:"page-size-selector",children:[e.jsx("label",{htmlFor:"pageSize",children:"Show:"}),e.jsx("select",{id:"pageSize",value:i,onChange:$=>p(Number($.target.value)),className:"page-size-select",children:g.map($=>e.jsx("option",{value:$,children:$},$))})]}),e.jsxs("div",{className:"pagination-buttons",children:[e.jsx("button",{className:"pagination-btn",onClick:()=>j(1),disabled:t===1,title:"First page",children:e.jsx(ds,{size:16})}),e.jsx("button",{className:"pagination-btn",onClick:()=>j(t-1),disabled:t===1,title:"Previous page",children:e.jsx(_t,{size:16})}),e.jsx("div",{className:"pagination-pages",children:N().map(($,v)=>e.jsx(zt.Fragment,{children:$==="..."?e.jsx("span",{className:"pagination-ellipsis",children:"..."}):e.jsx("button",{className:`pagination-page-btn ${$===t?"active":""}`,onClick:()=>j($),children:$})},v))}),e.jsx("button",{className:"pagination-btn",onClick:()=>j(t+1),disabled:t===n,title:"Next page",children:e.jsx(vt,{size:16})}),e.jsx("button",{className:"pagination-btn",onClick:()=>j(n),disabled:t===n,title:"Last page",children:e.jsx(us,{size:16})})]})]})]})},Ys=()=>{const t=dt(),[n,i]=s.useState([]),[k,f]=s.useState(!0),[p,g]=s.useState(!1),[j,N]=s.useState(null),[V,U]=s.useState(!1),[R,$]=s.useState(!1),[v,x]=s.useState(!1),[_,G]=s.useState(!1),[T,O]=s.useState(null),[X,ie]=s.useState(!1),[d,Q]=s.useState({}),[F,E]=s.useState(1),[W,te]=s.useState(20),[I,y]=s.useState(0),[L,H]=s.useState(0),[M,Y]=s.useState(""),[Z,re]=s.useState(""),[z,oe]=s.useState(null),[ee,le]=s.useState(null),[u,A]=s.useState({}),[we,ae]=s.useState(!1),[w,ne]=s.useState(!1),[D,ce]=s.useState({name:"",email:"",phone:"",company:"",position:"",location:"",status:"Active",last_contact:""}),[se,xe]=s.useState({}),[de,ze]=s.useState(!1);s.useEffect(()=>{w||q()},[F,W,M,d,w]),s.useEffect(()=>()=>{z&&clearTimeout(z)},[z]);const q=async()=>{try{n.length===0&&!M?f(!0):g(!0);const h={page:F,page_size:W};M&&(h.search=M),d.status&&d.status.length>0&&(h.status=d.status.join(",")),d.company&&d.company.length>0&&(h.company=d.company.join(",")),d.position&&d.position.length>0&&(h.position=d.position.join(",")),d.location&&d.location.length>0&&(h.location=d.location.join(","));const l=await Qe.getAll(h);i(l.items||[]),y(l.total_pages||0),H(l.total||0),N(null)}catch(h){console.error("Error fetching contacts:",h),N("Failed to load contacts. Please try again.")}finally{f(!1),g(!1)}},je=h=>{const l=h.target.value;re(l),z&&clearTimeout(z);const S=setTimeout(()=>{Y(l),F!==1&&E(1)},500);oe(S)},Ne=h=>{h.preventDefault(),z&&clearTimeout(z),Y(Z),F!==1&&E(1)},$e=()=>{re(""),Y(""),F!==1&&E(1),z&&clearTimeout(z)},ke=h=>{E(h)},Ae=h=>{te(h),E(1)},Ee=async h=>{const l=n.find(S=>S.id===h);O(l),G(!0)},Pe=async()=>{if(T){ie(!0);try{await Qe.delete(T.id),i(n.filter(h=>h.id!==T.id)),H(h=>h-1),G(!1),O(null),t.success("Contact deleted successfully!")}catch(h){console.error("Error deleting contact:",h),t.error("Failed to delete contact. Please try again.")}finally{ie(!1)}}},_e=()=>{G(!1),O(null)},fe=h=>{le(h.id),A({name:h.name||"",email:h.email||"",phone:h.phone||"",company:h.company||"",position:h.position||"",location:h.location||"",status:h.status||"Active"})},ve=()=>{le(null),A({})},De=h=>{const{name:l,value:S}=h.target;A(c=>({...c,[l]:S}))},Fe=async h=>{if(!u.name||!u.name.trim()){alert("Name is required");return}if(!u.email||!u.email.trim()){alert("Email is required");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(u.email)){alert("Please enter a valid email address");return}ae(!0);try{const S=await Qe.update(h,u);i(n.map(c=>c.id===h?{...c,...S}:c)),le(null),A({}),t.success("Contact updated successfully!")}catch(S){console.error("Error updating contact:",S),t.error(S.message||"Failed to update contact")}finally{ae(!1)}},Oe=()=>{U(!0),ce({name:"",email:"",phone:"",company:"",position:"",location:"",status:"Active",last_contact:""}),xe({})},pe=()=>{U(!1),ce({name:"",email:"",phone:"",company:"",position:"",location:"",status:"Active",last_contact:""}),xe({})},ge=h=>{const{name:l,value:S}=h.target;ce(c=>({...c,[l]:S})),se[l]&&xe(c=>({...c,[l]:""}))},Ce=()=>{const h={};return D.name.trim()||(h.name="Name is required"),D.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(D.email)||(h.email="Invalid email format"):h.email="Email is required",h},Le=async h=>{h.preventDefault();const l=Ce();if(Object.keys(l).length>0){xe(l);return}ze(!0);try{const S=await Qe.create(D);i(c=>[S,...c]),pe(),t.success("Contact created successfully!")}catch(S){console.error("Error creating contact:",S),t.error(S.message||"Failed to create contact")}finally{ze(!1)}},a=async(h,l=!1)=>{try{ne(!0);const S=await Qe.bulkUpload(h,l);return S.async||(ne(!1),await q()),S}catch(S){throw console.error("Error uploading Excel file:",S),ne(!1),S}},r=async h=>{try{const l=await Qe.getUploadProgress(h);return l.status==="completed"?(ne(!1),await q()):l.status==="failed"&&ne(!1),l}catch(l){throw console.error("Error getting upload progress:",l),ne(!1),l}},P=async()=>{try{await Qe.downloadTemplate()}catch(h){throw console.error("Error downloading template:",h),h}},J=h=>{Q(h),E(1)};let ue=null;const Te=async()=>(ue||(ue=await Qe.getFilterOptions()),ue),Ue=[{key:"status",label:"Status",type:"multiselect",icon:e.jsx(Dt,{size:16}),loadOptions:async()=>(await Te()).status||[]},{key:"company",label:"Company",type:"multiselect",icon:e.jsx(rt,{size:16}),loadOptions:async()=>(await Te()).company||[]},{key:"position",label:"Position",type:"multiselect",icon:e.jsx(hs,{size:16}),loadOptions:async()=>(await Te()).position||[]},{key:"location",label:"Location",type:"multiselect",icon:e.jsx(jt,{size:16}),loadOptions:async()=>(await Te()).location||[]}];return e.jsxs("div",{className:"contacts-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"page-title",children:"Contacts"}),e.jsx("p",{className:"page-subtitle",children:"Manage your customer relationships and contact information"})]}),e.jsxs("div",{style:{display:"flex",gap:"12px"},children:[e.jsx(C,{icon:e.jsx(qe,{size:18}),onClick:()=>$(!0),variant:"outline",children:"Upload Excel"}),e.jsx(C,{icon:e.jsx(tt,{size:18}),onClick:Oe,children:"Add Contact"})]})]}),k?e.jsx(yt,{count:6,size:"medium"}):j?e.jsx(he,{children:e.jsxs("div",{className:"error-state-container",children:[e.jsx("div",{className:"error-state-message",children:j}),e.jsx(C,{onClick:q,className:"error-state-retry-button",children:"Retry"})]})}):e.jsxs(he,{children:[e.jsx("div",{className:"contacts-toolbar",children:e.jsxs("div",{className:"search-filter",children:[e.jsxs("form",{onSubmit:Ne,style:{display:"flex",gap:"8px",flex:1},children:[e.jsx("input",{type:"text",placeholder:"Search contacts...",className:"search-input-compact",value:Z,onChange:je,style:{flex:1}}),Z&&e.jsx(C,{type:"button",variant:"outline",onClick:$e,style:{padding:"0 12px"},children:e.jsx(be,{size:18})}),e.jsx(C,{type:"submit",variant:"outline",disabled:p,children:p?"Searching...":"Search"})]}),e.jsxs(C,{variant:"outline",icon:e.jsx(ot,{size:18}),onClick:()=>x(!0),children:["Filter",Object.keys(d).length>0&&e.jsx("span",{style:{marginLeft:"6px",padding:"2px 6px",background:"#3b82f6",color:"white",borderRadius:"10px",fontSize:"11px",fontWeight:"600"},children:Object.keys(d).length})]})]})}),p?e.jsxs("div",{style:{padding:"2rem",textAlign:"center",color:"#64748b"},children:[e.jsx(Xe,{}),e.jsx("div",{style:{marginTop:"8px"},children:"Searching..."})]}):e.jsx("div",{className:"contacts-grid",children:n.length===0?e.jsx("div",{style:{padding:"40px",textAlign:"center",gridColumn:"1 / -1"},children:M?"No contacts found matching your search.":'No contacts found. Click "Add Contact" to create one.'}):n.map(h=>e.jsxs("div",{className:"contact-card",children:[e.jsx("div",{className:"contact-avatar",children:h.name.split(" ").map(l=>l[0]).join("")}),e.jsxs("div",{className:"contact-info",children:[e.jsx("h3",{className:"contact-name",children:h.name}),e.jsxs("p",{className:"contact-position",children:[h.position," at ",h.company]}),e.jsxs("div",{className:"contact-details",children:[e.jsxs("div",{className:"contact-detail",children:[e.jsx(Ot,{size:16}),e.jsx("span",{children:h.email})]}),e.jsxs("div",{className:"contact-detail",children:[e.jsx(ms,{size:16}),e.jsx("span",{children:h.phone})]}),e.jsxs("div",{className:"contact-detail",children:[e.jsx(jt,{size:16}),e.jsx("span",{children:h.location})]})]}),e.jsx("div",{className:"contact-footer",children:e.jsx("span",{className:`status-badge ${h.status.toLowerCase()}`,children:h.status})})]}),e.jsxs("div",{className:"contact-actions",children:[e.jsx("button",{className:"action-btn",title:"Edit",onClick:()=>fe(h),children:e.jsx(it,{size:16})}),e.jsx("button",{className:"action-btn danger",title:"Delete",onClick:()=>Ee(h.id),disabled:X&&T?.id===h.id,children:e.jsx(Je,{size:16})})]})]},h.id))}),!k&&!j&&!p&&L>0&&e.jsx(at,{currentPage:F,totalPages:I,pageSize:W,total:L,onPageChange:ke,onPageSizeChange:Ae})]}),V&&e.jsx("div",{className:"modal-overlay",onClick:pe,children:e.jsxs("div",{className:"modal",onClick:h=>h.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{className:"modal-title",children:"Add Contact"}),e.jsx("button",{className:"close-btn",onClick:pe,children:"×"})]}),e.jsxs("form",{onSubmit:Le,className:"modal-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"name",className:"form-label",children:"Name"}),e.jsx("input",{type:"text",id:"name",name:"name",value:D.name,onChange:ge,className:"form-input",placeholder:"Enter name"}),se.name&&e.jsx("div",{className:"form-error",children:se.name})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"email",className:"form-label",children:"Email"}),e.jsx("input",{type:"email",id:"email",name:"email",value:D.email,onChange:ge,className:"form-input",placeholder:"Enter email"}),se.email&&e.jsx("div",{className:"form-error",children:se.email})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"phone",className:"form-label",children:"Phone"}),e.jsx("input",{type:"text",id:"phone",name:"phone",value:D.phone,onChange:ge,className:"form-input",placeholder:"Enter phone number"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"company",className:"form-label",children:"Company"}),e.jsx("input",{type:"text",id:"company",name:"company",value:D.company,onChange:ge,className:"form-input",placeholder:"Enter company name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"position",className:"form-label",children:"Position"}),e.jsx("input",{type:"text",id:"position",name:"position",value:D.position,onChange:ge,className:"form-input",placeholder:"Enter position"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"location",className:"form-label",children:"Location"}),e.jsx("input",{type:"text",id:"location",name:"location",value:D.location,onChange:ge,className:"form-input",placeholder:"Enter location"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"status",className:"form-label",children:"Status"}),e.jsxs("select",{id:"status",name:"status",value:D.status,onChange:ge,className:"form-select",children:[e.jsx("option",{value:"Active",children:"Active"}),e.jsx("option",{value:"Inactive",children:"Inactive"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"last_contact",className:"form-label",children:"Last Contact"}),e.jsx("input",{type:"date",id:"last_contact",name:"last_contact",value:D.last_contact,onChange:ge,className:"form-input"})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx(C,{onClick:pe,variant:"outline",disabled:de,children:"Cancel"}),e.jsx(C,{type:"submit",disabled:de,children:de?"Creating...":"Create Contact"})]})]})]})}),e.jsx(st,{isOpen:R,onClose:()=>{$(!1),ne(!1)},onUpload:a,onDownloadTemplate:P,onGetProgress:r,title:"Upload Contacts from Excel",entityName:"contacts"}),e.jsx(mt,{isOpen:v,onClose:()=>x(!1),onApply:J,filters:d,filterConfigs:Ue}),ee&&e.jsx("div",{className:"edit-contact-overlay",onClick:ve,children:e.jsxs("div",{className:"edit-contact-modal",onClick:h=>h.stopPropagation(),children:[e.jsxs("div",{className:"edit-contact-header",children:[e.jsx("h2",{className:"edit-contact-title",children:"Edit Contact"}),e.jsx("button",{className:"close-btn",onClick:ve,children:"×"})]}),e.jsxs("form",{onSubmit:h=>{h.preventDefault(),Fe(ee)},className:"edit-contact-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"edit_name",className:"form-label",children:["Name ",e.jsx("span",{style:{color:"#ef4444"},children:"*"})]}),e.jsx("input",{type:"text",id:"edit_name",name:"name",value:u.name,onChange:De,className:"form-input",placeholder:"Enter name",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"edit_email",className:"form-label",children:["Email ",e.jsx("span",{style:{color:"#ef4444"},children:"*"})]}),e.jsx("input",{type:"email",id:"edit_email",name:"email",value:u.email,onChange:De,className:"form-input",placeholder:"Enter email",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit_phone",className:"form-label",children:"Phone"}),e.jsx("input",{type:"text",id:"edit_phone",name:"phone",value:u.phone,onChange:De,className:"form-input",placeholder:"Enter phone number"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit_company",className:"form-label",children:"Company"}),e.jsx("input",{type:"text",id:"edit_company",name:"company",value:u.company,onChange:De,className:"form-input",placeholder:"Enter company name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit_position",className:"form-label",children:"Position"}),e.jsx("input",{type:"text",id:"edit_position",name:"position",value:u.position,onChange:De,className:"form-input",placeholder:"Enter position"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit_location",className:"form-label",children:"Location"}),e.jsx("input",{type:"text",id:"edit_location",name:"location",value:u.location,onChange:De,className:"form-input",placeholder:"Enter location"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit_status",className:"form-label",children:"Status"}),e.jsxs("select",{id:"edit_status",name:"status",value:u.status,onChange:De,className:"form-select",children:[e.jsx("option",{value:"Active",children:"Active"}),e.jsx("option",{value:"Inactive",children:"Inactive"})]})]}),e.jsxs("div",{className:"edit-contact-footer",children:[e.jsx(C,{type:"button",onClick:ve,variant:"outline",disabled:we,children:"Cancel"}),e.jsx(C,{type:"submit",disabled:we,children:we?"Saving...":"Save Changes"})]})]})]})}),e.jsx(ut,{isOpen:_,onClose:_e,onConfirm:Pe,title:"Delete Contact",message:T?`Are you sure you want to delete "${T.name}"? This action cannot be undone.`:"Are you sure you want to delete this contact?",confirmText:"Delete",cancelText:"Cancel",type:"danger",loading:X})]})},Js=t=>t>=1e9?(t/1e9).toFixed(1).replace(/\.0$/,"")+"B":t>=1e6?(t/1e6).toFixed(1).replace(/\.0$/,"")+"M":t>=1e3?(t/1e3).toFixed(1).replace(/\.0$/,"")+"K":t.toString(),Xs=()=>{const t=dt(),[n,i]=s.useState([]),[k,f]=s.useState(!0),[p,g]=s.useState(!1),[j,N]=s.useState(null),[V,U]=s.useState(!1),[R,$]=s.useState(!1),[v,x]=s.useState(!1),[_,G]=s.useState(!1),[T,O]=s.useState(null),[X,ie]=s.useState(!1),[d,Q]=s.useState({}),[F,E]=s.useState(1),[W,te]=s.useState(20),[I,y]=s.useState(0),[L,H]=s.useState(0),[M,Y]=s.useState(""),[Z,re]=s.useState(""),[z,oe]=s.useState(null),[ee,le]=s.useState(null),[u,A]=s.useState({}),[we,ae]=s.useState(!1),[w,ne]=s.useState({name:"",company:"",email:"",phone:"",source:"",status:"New",score:0,value:"",assigned_to:""}),[D,ce]=s.useState({}),[se,xe]=s.useState(!1),[de,ze]=s.useState({total_leads:0,qualified_leads:0,avg_score:0,total_value:0});s.useEffect(()=>{q(),je()},[F,W,M,d]),s.useEffect(()=>()=>{z&&clearTimeout(z)},[z]);const q=async()=>{try{n.length===0&&!M?f(!0):g(!0);const m={page:F,page_size:W};M&&(m.search=M),d.status&&d.status.length>0&&(m.status=d.status.join(",")),d.source&&d.source.length>0&&(m.source=d.source.join(",")),d.assigned_to&&d.assigned_to.length>0&&(m.assigned_to=d.assigned_to.join(",")),d.score?.min&&(m.score_min=d.score.min),d.score?.max&&(m.score_max=d.score.max);const me=await We.getAll(m);i(me.items||[]),y(me.total_pages||0),H(me.total||0),N(null)}catch(m){console.error("Error fetching leads:",m),N("Failed to load leads. Please try again.")}finally{f(!1),g(!1)}},je=async()=>{try{const m=await We.getSummary();ze(m)}catch(m){console.error("Error fetching summary:",m)}},Ne=m=>{const me=m.target.value;re(me),z&&clearTimeout(z);const Se=setTimeout(()=>{Y(me),F!==1&&E(1)},500);oe(Se)},$e=m=>{m.preventDefault(),z&&clearTimeout(z),Y(Z),F!==1&&E(1)},ke=()=>{re(""),Y(""),F!==1&&E(1),z&&clearTimeout(z)},Ae=m=>{E(m)},Ee=m=>{te(m),E(1)},Pe=m=>m>=80?"#10b981":m>=60?"#f59e0b":"#ef4444",_e=m=>({New:"#3b82f6",Contacted:"#8b5cf6",Qualified:"#10b981",Nurturing:"#f59e0b"})[m]||"#64748b",fe=m=>{const{name:me,value:Se}=m.target;ne(Re=>({...Re,[me]:Se})),D[me]&&ce(Re=>({...Re,[me]:""}))},ve=()=>{const m={};return w.name.trim()||(m.name="Name is required"),w.company.trim()||(m.company="Company is required"),w.email.trim()?/\S+@\S+\.\S+/.test(w.email)||(m.email="Email is invalid"):m.email="Email is required",(w.score<0||w.score>100)&&(m.score="Score must be between 0 and 100"),m},De=async m=>{m.preventDefault();const me=ve();if(Object.keys(me).length>0){ce(me);return}try{xe(!0),await We.create(w),await q(),await je(),U(!1),Fe(),t.success("Lead created successfully!")}catch(Se){console.error("Error creating lead:",Se),t.error(Se.message||"Failed to create lead"),ce({submit:Se.message||"Failed to create lead. Please try again."})}finally{xe(!1)}},Fe=()=>{ne({name:"",company:"",email:"",phone:"",source:"",status:"New",score:0,value:"",assigned_to:""}),ce({})},Oe=()=>{Fe(),U(!0)},pe=()=>{U(!1),Fe()},ge=async(m,me=!1)=>{try{const Se=await We.bulkUpload(m,me);return Se.async||(await q(),await je()),Se}catch(Se){throw console.error("Error uploading Excel file:",Se),Se}},Ce=async m=>{try{const me=await We.getUploadProgress(m);return me.status==="completed"&&(await q(),await je()),me}catch(me){throw console.error("Error getting upload progress:",me),me}},Le=async()=>{try{await We.downloadTemplate()}catch(m){throw console.error("Error downloading template:",m),m}},a=m=>{Q(m),E(1)},r=m=>{le(m.id),A({name:m.name||"",company:m.company||"",email:m.email||"",phone:m.phone||"",source:m.source||"",status:m.status||"New",score:m.score||0,value:m.value||"",assigned_to:m.assigned_to||""})},P=()=>{le(null),A({})},J=m=>{const{name:me,value:Se}=m.target;A(Re=>({...Re,[me]:Se}))},ue=async m=>{if(!u.name||!u.name.trim()){alert("Name is required");return}if(!u.email||!u.email.trim()){alert("Email is required");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(u.email)){alert("Please enter a valid email address");return}const Se=parseInt(u.score);if(isNaN(Se)||Se<0||Se>100){alert("Score must be between 0 and 100");return}ae(!0);try{const Re=await We.update(m,u);i(n.map(bt=>bt.id===m?{...bt,...Re}:bt)),await je(),le(null),A({}),t.success("Lead updated successfully!")}catch(Re){console.error("Error updating lead:",Re),t.error(Re.message||"Failed to update lead")}finally{ae(!1)}},Te=async m=>{const me=n.find(Se=>Se.id===m);O(me),G(!0)},Ue=async()=>{if(T){ie(!0);try{await We.delete(T.id),i(n.filter(m=>m.id!==T.id)),H(m=>m-1),await je(),G(!1),O(null),t.success("Lead deleted successfully!")}catch(m){console.error("Error deleting lead:",m),t.error("Failed to delete lead. Please try again.")}finally{ie(!1)}}},h=()=>{G(!1),O(null)};let l=null;const S=async()=>(l||(l=await We.getFilterOptions()),l),c=[{key:"status",label:"Status",type:"multiselect",icon:e.jsx(Ke,{size:16}),loadOptions:async()=>(await S()).status||[]},{key:"source",label:"Source",type:"multiselect",icon:e.jsx(et,{size:16}),loadOptions:async()=>(await S()).source||[]},{key:"assigned_to",label:"Assigned To",type:"multiselect",icon:e.jsx(Ye,{size:16}),loadOptions:async()=>(await S()).assigned_to||[]},{key:"score",label:"Lead Score",type:"range",icon:e.jsx(Tt,{size:16})}],B=de.total_leads,o=de.qualified_leads,K=de.avg_score,ye=de.total_value;return e.jsxs("div",{className:"leads-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"page-title",children:"Leads"}),e.jsx("p",{className:"page-subtitle",children:"Track and convert potential customers into opportunities"})]}),e.jsxs("div",{style:{display:"flex",gap:"12px"},children:[e.jsx(C,{icon:e.jsx(qe,{size:18}),onClick:()=>$(!0),variant:"outline",children:"Upload Excel"}),e.jsx(C,{icon:e.jsx(tt,{size:18}),onClick:Oe,children:"Add Lead"})]})]}),k?e.jsx(yt,{count:6,size:"large"}):j?e.jsx(he,{children:e.jsxs("div",{className:"error-state-container",children:[e.jsx("div",{className:"error-state-message",children:j}),e.jsx(C,{onClick:q,className:"error-state-retry-button",children:"Retry"})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"leads-metrics",children:[e.jsxs("div",{className:"metric-card",children:[e.jsx("div",{className:"metric-icon",style:{background:"#3b82f620",color:"#3b82f6"},children:e.jsx(Ye,{size:24})}),e.jsxs("div",{className:"metric-content",children:[e.jsx("div",{className:"metric-label",children:"Total Leads"}),e.jsx("div",{className:"metric-value",children:e.jsx(Be,{value:B,duration:1200})})]})]}),e.jsxs("div",{className:"metric-card",children:[e.jsx("div",{className:"metric-icon",style:{background:"#10b98120",color:"#10b981"},children:e.jsx(Ke,{size:24})}),e.jsxs("div",{className:"metric-content",children:[e.jsx("div",{className:"metric-label",children:"Qualified Leads"}),e.jsx("div",{className:"metric-value",children:e.jsx(Be,{value:o,duration:1200})})]})]}),e.jsxs("div",{className:"metric-card",children:[e.jsx("div",{className:"metric-icon",style:{background:"#f59e0b20",color:"#f59e0b"},children:e.jsx(Tt,{size:24})}),e.jsxs("div",{className:"metric-content",children:[e.jsx("div",{className:"metric-label",children:"Avg. Score"}),e.jsx("div",{className:"metric-value",children:e.jsx(Be,{value:K,duration:1200})})]})]}),e.jsxs("div",{className:"metric-card",children:[e.jsx("div",{className:"metric-icon",style:{background:"#8b5cf620",color:"#8b5cf6"},children:e.jsx(ct,{size:24})}),e.jsxs("div",{className:"metric-content",children:[e.jsx("div",{className:"metric-label",children:"Total Value"}),e.jsxs("div",{className:"metric-value",children:["$",Js(ye)]})]})]})]}),e.jsxs(he,{children:[e.jsxs("div",{className:"leads-toolbar",children:[e.jsxs("form",{onSubmit:$e,style:{flex:1,display:"flex",gap:"8px"},children:[e.jsx("input",{type:"text",placeholder:"Search leads...",className:"search-input-compact",value:Z,onChange:Ne,style:{flex:1}}),Z&&e.jsx(C,{type:"button",variant:"outline",onClick:ke,style:{padding:"0 12px"},children:e.jsx(be,{size:18})}),e.jsx(C,{type:"submit",variant:"outline",disabled:p,children:p?"Searching...":"Search"})]}),e.jsxs(C,{variant:"outline",icon:e.jsx(ot,{size:18}),onClick:()=>x(!0),children:["Filter",Object.keys(d).length>0&&e.jsx("span",{style:{marginLeft:"6px",padding:"2px 6px",background:"#3b82f6",color:"white",borderRadius:"10px",fontSize:"11px",fontWeight:"600"},children:Object.keys(d).length})]})]}),e.jsx("div",{className:"table-container",children:p?e.jsxs("div",{style:{padding:"2rem",textAlign:"center",color:"#64748b"},children:[e.jsx(Xe,{}),e.jsx("div",{style:{marginTop:"8px"},children:"Searching..."})]}):e.jsxs("table",{className:"data-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Lead Name"}),e.jsx("th",{children:"Company"}),e.jsx("th",{children:"Contact"}),e.jsx("th",{children:"Source"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Score"}),e.jsx("th",{children:"Est. Value"}),e.jsx("th",{children:"Assigned To"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:n.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"9",style:{textAlign:"center",padding:"2rem"},children:M?"No leads found matching your search.":'No leads found. Click "Add Lead" to create one.'})}):n.map(m=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-semibold",children:m.name}),e.jsx("td",{children:m.company}),e.jsx("td",{children:e.jsxs("div",{className:"contact-cell",children:[e.jsx("div",{children:m.email}),e.jsx("div",{className:"phone-text",children:m.phone})]})}),e.jsx("td",{children:m.source}),e.jsx("td",{children:e.jsx("span",{className:"status-pill",style:{background:`${_e(m.status)}20`,color:_e(m.status)},children:m.status})}),e.jsx("td",{children:e.jsxs("div",{className:"score-cell",children:[e.jsx("div",{className:"score-bar",style:{width:`${m.score}%`,background:Pe(m.score)}}),e.jsx("span",{className:"score-text",children:m.score})]})}),e.jsx("td",{className:"font-semibold text-success",children:m.value}),e.jsx("td",{children:m.assigned_to}),e.jsxs("td",{className:"actions-cell",children:[e.jsx("button",{className:"action-btn",title:"Edit",onClick:()=>r(m),children:e.jsx(it,{size:16})}),e.jsx("button",{className:"action-btn danger",title:"Delete",onClick:()=>Te(m.id),disabled:X&&T?.id===m.id,children:e.jsx(Je,{size:16})})]})]},m.id))})]})}),!k&&!j&&!p&&L>0&&e.jsx(at,{currentPage:F,totalPages:I,pageSize:W,total:L,onPageChange:Ae,onPageSizeChange:Ee})]})]}),V&&e.jsx("div",{className:"modal-overlay",onClick:pe,children:e.jsxs("div",{className:"modal-content",onClick:m=>m.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"Add New Lead"}),e.jsx("button",{className:"modal-close",onClick:pe,children:e.jsx(be,{size:24})})]}),e.jsxs("form",{onSubmit:De,className:"modal-form",children:[e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"name",children:["Name ",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("input",{type:"text",id:"name",name:"name",value:w.name,onChange:fe,className:D.name?"error":"",placeholder:"Enter lead name"}),D.name&&e.jsx("span",{className:"error-text",children:D.name})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"company",children:["Company ",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("input",{type:"text",id:"company",name:"company",value:w.company,onChange:fe,className:D.company?"error":"",placeholder:"Enter company name"}),D.company&&e.jsx("span",{className:"error-text",children:D.company})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"email",children:["Email ",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("input",{type:"email",id:"email",name:"email",value:w.email,onChange:fe,className:D.email?"error":"",placeholder:"email@example.com"}),D.email&&e.jsx("span",{className:"error-text",children:D.email})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"phone",children:"Phone"}),e.jsx("input",{type:"tel",id:"phone",name:"phone",value:w.phone,onChange:fe,placeholder:"(555) 123-4567"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"source",children:"Source"}),e.jsxs("select",{id:"source",name:"source",value:w.source,onChange:fe,children:[e.jsx("option",{value:"",children:"Select source"}),e.jsx("option",{value:"Website",children:"Website"}),e.jsx("option",{value:"Referral",children:"Referral"}),e.jsx("option",{value:"LinkedIn",children:"LinkedIn"}),e.jsx("option",{value:"Cold Call",children:"Cold Call"}),e.jsx("option",{value:"Event",children:"Event"}),e.jsx("option",{value:"Email Campaign",children:"Email Campaign"}),e.jsx("option",{value:"Other",children:"Other"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"status",children:"Status"}),e.jsxs("select",{id:"status",name:"status",value:w.status,onChange:fe,children:[e.jsx("option",{value:"New",children:"New"}),e.jsx("option",{value:"Contacted",children:"Contacted"}),e.jsx("option",{value:"Qualified",children:"Qualified"}),e.jsx("option",{value:"Nurturing",children:"Nurturing"}),e.jsx("option",{value:"Lost",children:"Lost"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"score",children:"Lead Score (0-100)"}),e.jsx("input",{type:"number",id:"score",name:"score",min:"0",max:"100",value:w.score,onChange:fe,className:D.score?"error":""}),D.score&&e.jsx("span",{className:"error-text",children:D.score})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"value",children:"Estimated Value"}),e.jsx("input",{type:"text",id:"value",name:"value",value:w.value,onChange:fe,placeholder:"$50,000"})]}),e.jsxs("div",{className:"form-group full-width",children:[e.jsx("label",{htmlFor:"assigned_to",children:"Assigned To"}),e.jsx("input",{type:"text",id:"assigned_to",name:"assigned_to",value:w.assigned_to,onChange:fe,placeholder:"Enter assignee name"})]})]}),D.submit&&e.jsx("div",{className:"error-message",children:D.submit}),e.jsxs("div",{className:"modal-actions",children:[e.jsx(C,{type:"button",variant:"outline",onClick:pe,children:"Cancel"}),e.jsx(C,{type:"submit",disabled:se,children:se?"Creating...":"Create Lead"})]})]})]})}),e.jsx(st,{isOpen:R,onClose:()=>$(!1),onUpload:ge,onDownloadTemplate:Le,onGetProgress:Ce,title:"Upload Leads from Excel",entityName:"leads"}),e.jsx(mt,{isOpen:v,onClose:()=>x(!1),onApply:a,filters:d,filterConfigs:c}),ee&&e.jsx("div",{className:"edit-lead-overlay",onClick:P,children:e.jsxs("div",{className:"edit-lead-modal",onClick:m=>m.stopPropagation(),children:[e.jsxs("div",{className:"edit-lead-header",children:[e.jsx("h2",{className:"edit-lead-title",children:"Edit Lead"}),e.jsx("button",{className:"modal-close",onClick:P,children:e.jsx(be,{size:24})})]}),e.jsxs("form",{onSubmit:m=>{m.preventDefault(),ue(ee)},className:"edit-lead-form",children:[e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"edit_name",children:["Lead Name ",e.jsx("span",{style:{color:"#ef4444"},children:"*"})]}),e.jsx("input",{type:"text",id:"edit_name",name:"name",value:u.name,onChange:J,placeholder:"Enter lead name",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit_company",children:"Company"}),e.jsx("input",{type:"text",id:"edit_company",name:"company",value:u.company,onChange:J,placeholder:"Enter company name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"edit_email",children:["Email ",e.jsx("span",{style:{color:"#ef4444"},children:"*"})]}),e.jsx("input",{type:"email",id:"edit_email",name:"email",value:u.email,onChange:J,placeholder:"email@example.com",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit_phone",children:"Phone"}),e.jsx("input",{type:"text",id:"edit_phone",name:"phone",value:u.phone,onChange:J,placeholder:"(555) 123-4567"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit_source",children:"Source"}),e.jsxs("select",{id:"edit_source",name:"source",value:u.source,onChange:J,children:[e.jsx("option",{value:"",children:"Select source"}),e.jsx("option",{value:"Website",children:"Website"}),e.jsx("option",{value:"Referral",children:"Referral"}),e.jsx("option",{value:"Social Media",children:"Social Media"}),e.jsx("option",{value:"Email Campaign",children:"Email Campaign"}),e.jsx("option",{value:"Event",children:"Event"}),e.jsx("option",{value:"Cold Call",children:"Cold Call"}),e.jsx("option",{value:"Other",children:"Other"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit_status",children:"Status"}),e.jsxs("select",{id:"edit_status",name:"status",value:u.status,onChange:J,children:[e.jsx("option",{value:"New",children:"New"}),e.jsx("option",{value:"Contacted",children:"Contacted"}),e.jsx("option",{value:"Qualified",children:"Qualified"}),e.jsx("option",{value:"Unqualified",children:"Unqualified"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"edit_score",children:["Score (0-100) ",e.jsx("span",{style:{color:"#ef4444"},children:"*"})]}),e.jsx("input",{type:"number",id:"edit_score",name:"score",value:u.score,onChange:J,min:"0",max:"100",placeholder:"0-100",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit_value",children:"Estimated Value"}),e.jsx("input",{type:"text",id:"edit_value",name:"value",value:u.value,onChange:J,placeholder:"$50,000"})]}),e.jsxs("div",{className:"form-group full-width",children:[e.jsx("label",{htmlFor:"edit_assigned_to",children:"Assigned To"}),e.jsx("input",{type:"text",id:"edit_assigned_to",name:"assigned_to",value:u.assigned_to,onChange:J,placeholder:"Enter assignee name"})]})]}),e.jsxs("div",{className:"edit-lead-footer",children:[e.jsx(C,{type:"button",onClick:P,variant:"outline",disabled:we,children:"Cancel"}),e.jsx(C,{type:"submit",disabled:we,children:we?"Saving...":"Save Changes"})]})]})]})}),e.jsx(ut,{isOpen:_,onClose:h,onConfirm:Ue,title:"Delete Lead",message:T?`Are you sure you want to delete "${T.name}"? This action cannot be undone.`:"Are you sure you want to delete this lead?",confirmText:"Delete",cancelText:"Cancel",type:"danger",loading:X})]})},Zs=()=>{const t=dt(),[n,i]=s.useState([]),[k,f]=s.useState(!0),[p,g]=s.useState(!1),[j,N]=s.useState(null),[V,U]=s.useState(!1),[R,$]=s.useState(!1),[v,x]=s.useState(!1),[_,G]=s.useState(!1),[T,O]=s.useState(null),[X,ie]=s.useState(!1),[d,Q]=s.useState({}),[F,E]=s.useState(1),[W,te]=s.useState(20),[I,y]=s.useState(0),[L,H]=s.useState(0),[M,Y]=s.useState(""),[Z,re]=s.useState(""),[z,oe]=s.useState(null),[ee,le]=s.useState(null),[u,A]=s.useState({}),[we,ae]=s.useState(!1),[w,ne]=s.useState({name:"",account:"",value:"",stage:"Prospecting",probability:"10",close_date:"",owner:"",contact_id:""}),[D,ce]=s.useState({}),[se,xe]=s.useState(!1);s.useEffect(()=>{de()},[F,W,M,d]),s.useEffect(()=>()=>{z&&clearTimeout(z)},[z]);const de=async()=>{try{n.length===0&&!M?f(!0):g(!0),N(null);const l={page:F,page_size:W};M&&(l.search=M),d.stage&&d.stage.length>0&&(l.stage=d.stage.join(",")),d.account&&d.account.length>0&&(l.account=d.account.join(",")),d.owner&&d.owner.length>0&&(l.owner=d.owner.join(",")),d.value?.min&&(l.value_min=d.value.min),d.value?.max&&(l.value_max=d.value.max),d.probability?.min&&(l.probability_min=d.probability.min),d.probability?.max&&(l.probability_max=d.probability.max);const S=await Ie.getAll(l);i(S.items||[]),y(S.total_pages||0),H(S.total||0)}catch(l){console.error("Error fetching opportunities:",l),N("Failed to load opportunities. Please try again.")}finally{f(!1),g(!1)}},ze=l=>{const S=l.target.value;re(S),z&&clearTimeout(z);const c=setTimeout(()=>{Y(S),F!==1&&E(1)},500);oe(c)},q=l=>{l.preventDefault(),z&&clearTimeout(z),Y(Z),F!==1&&E(1)},je=()=>{re(""),Y(""),F!==1&&E(1),z&&clearTimeout(z)},Ne=l=>{E(l)},$e=l=>{te(l),E(1)},ke=l=>{const{name:S,value:c}=l.target;ne(B=>({...B,[S]:c})),D[S]&&ce(B=>({...B,[S]:""}))},Ae=()=>{const l={};return w.name.trim()||(l.name="Opportunity name is required"),w.account.trim()||(l.account="Account is required"),(!w.value||parseFloat(w.value)<=0)&&(l.value="Value must be greater than 0"),w.probability&&(parseInt(w.probability)<0||parseInt(w.probability)>100)&&(l.probability="Probability must be between 0 and 100"),ce(l),Object.keys(l).length===0},Ee=async l=>{if(l.preventDefault(),!!Ae()){xe(!0);try{const S={name:w.name.trim(),account:w.account.trim(),value:parseFloat(w.value),stage:w.stage,probability:parseInt(w.probability),close_date:w.close_date||null,owner:w.owner.trim()||null,contact_id:w.contact_id?parseInt(w.contact_id):null};await Ie.create(S),ne({name:"",account:"",value:"",stage:"Prospecting",probability:"10",close_date:"",owner:"",contact_id:""}),ce({}),U(!1),t.success("Opportunity created successfully!"),await de()}catch(S){console.error("Error creating opportunity:",S),t.error(S.message||"Failed to create opportunity"),ce({submit:S.message||"Failed to create opportunity"})}finally{xe(!1)}}},Pe=()=>{U(!1),ne({name:"",account:"",value:"",stage:"Prospecting",probability:"10",close_date:"",owner:"",contact_id:""}),ce({})},_e=async(l,S=!1)=>{try{const c=await Ie.bulkUpload(l,S);return c.async||await de(),c}catch(c){throw console.error("Error uploading Excel file:",c),c}},fe=async l=>{try{const S=await Ie.getUploadProgress(l);return S.status==="completed"&&await de(),S}catch(S){throw console.error("Error getting upload progress:",S),S}},ve=async()=>{try{await Ie.downloadTemplate()}catch(l){throw console.error("Error downloading template:",l),l}},De=l=>{Q(l),E(1)},Fe=l=>{le(l.id),A({name:l.name||"",account:l.account||"",value:l.value||"",stage:l.stage||"Prospecting",probability:l.probability||"10",close_date:l.close_date||"",owner:l.owner||"",contact_id:l.contact_id||""})},Oe=()=>{le(null),A({})},pe=l=>{const{name:S,value:c}=l.target;A(B=>({...B,[S]:c}))},ge=async l=>{if(!u.name||!u.name.trim()){alert("Opportunity name is required");return}if(!u.account||!u.account.trim()){alert("Account is required");return}if(!u.value||parseFloat(u.value)<=0){alert("Value must be greater than 0");return}const S=parseInt(u.probability);if(isNaN(S)||S<0||S>100){alert("Probability must be between 0 and 100");return}ae(!0);try{const c={name:u.name.trim(),account:u.account.trim(),value:parseFloat(u.value),stage:u.stage,probability:parseInt(u.probability),close_date:u.close_date||null,owner:u.owner.trim()||null,contact_id:u.contact_id?parseInt(u.contact_id):null},B=await Ie.update(l,c);i(n.map(o=>o.id===l?{...o,...B}:o)),le(null),A({}),t.success("Opportunity updated successfully!")}catch(c){console.error("Error updating opportunity:",c),t.error(c.message||"Failed to update opportunity")}finally{ae(!1)}},Ce=async l=>{const S=n.find(c=>c.id===l);O(S),G(!0)},Le=async()=>{if(T){ie(!0);try{await Ie.delete(T.id),i(n.filter(l=>l.id!==T.id)),H(l=>l-1),G(!1),O(null),t.success("Opportunity deleted successfully!")}catch(l){console.error("Error deleting opportunity:",l),t.error("Failed to delete opportunity. Please try again.")}finally{ie(!1)}}},a=()=>{G(!1),O(null)};let r=null;const P=async()=>(r||(r=await Ie.getFilterOptions()),r),J=[{key:"stage",label:"Stage",type:"multiselect",icon:e.jsx(Ke,{size:16}),loadOptions:async()=>(await P()).stage||[]},{key:"account",label:"Account",type:"multiselect",icon:e.jsx(rt,{size:16}),loadOptions:async()=>(await P()).account||[]},{key:"owner",label:"Owner",type:"multiselect",icon:e.jsx(Ye,{size:16}),loadOptions:async()=>(await P()).owner||[]},{key:"value",label:"Value",type:"range",icon:e.jsx(ct,{size:16})},{key:"probability",label:"Probability (%)",type:"range",icon:e.jsx(ps,{size:16})}],ue={Prospecting:"#64748b",Qualification:"#64748b",Proposal:"#3b82f6",Negotiation:"#f59e0b","Closed Won":"#10b981","Closed Lost":"#ef4444"},Te=n.reduce((l,S)=>{const c=typeof S.amount=="number"?S.amount:parseFloat(String(S.amount).replace(/[$,]/g,""))||0;return l+c},0),Ue=n.reduce((l,S)=>{const c=typeof S.amount=="number"?S.amount:parseFloat(String(S.amount).replace(/[$,]/g,""))||0,B=S.probability||0;return l+c*B/100},0),h=l=>`$${(typeof l=="number"?l:parseFloat(String(l).replace(/[$,]/g,""))||0).toLocaleString()}`;return e.jsxs("div",{className:"opportunities-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"page-title",children:"Opportunities"}),e.jsx("p",{className:"page-subtitle",children:"Manage sales opportunities and track deals through your pipeline"})]}),e.jsxs("div",{style:{display:"flex",gap:"12px"},children:[e.jsx(C,{icon:e.jsx(qe,{size:18}),onClick:()=>$(!0),variant:"outline",children:"Upload Excel"}),e.jsx(C,{icon:e.jsx(tt,{size:18}),onClick:()=>U(!0),children:"Add Opportunity"})]})]}),k?e.jsx(yt,{count:6,size:"large"}):j?e.jsx(he,{children:e.jsxs("div",{className:"error-state-container",children:[e.jsx("div",{className:"error-state-message",children:j}),e.jsx(C,{onClick:de,className:"error-state-retry-button",children:"Retry"})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"opp-metrics",children:[e.jsxs("div",{className:"metric-card",children:[e.jsx("div",{className:"metric-icon",style:{background:"#3b82f620",color:"#3b82f6"},children:e.jsx(et,{size:24})}),e.jsxs("div",{className:"metric-content",children:[e.jsx("div",{className:"metric-label",children:"Total Pipeline"}),e.jsxs("div",{className:"metric-value",children:["$",e.jsx(Be,{value:Te,duration:1200,separator:","})]})]})]}),e.jsxs("div",{className:"metric-card",children:[e.jsx("div",{className:"metric-icon",style:{background:"#10b98120",color:"#10b981"},children:e.jsx(ct,{size:24})}),e.jsxs("div",{className:"metric-content",children:[e.jsx("div",{className:"metric-label",children:"Weighted Pipeline"}),e.jsxs("div",{className:"metric-value",children:["$",e.jsx(Be,{value:Math.round(Ue),duration:1200,separator:","})]})]})]}),e.jsxs("div",{className:"metric-card",children:[e.jsx("div",{className:"metric-icon",style:{background:"#8b5cf620",color:"#8b5cf6"},children:e.jsx(et,{size:24})}),e.jsxs("div",{className:"metric-content",children:[e.jsx("div",{className:"metric-label",children:"Open Opportunities"}),e.jsx("div",{className:"metric-value",children:e.jsx(Be,{value:n.filter(l=>!String(l.stage).includes("Closed")).length,duration:1200})})]})]})]}),e.jsxs(he,{title:"All Opportunities",children:[e.jsxs("div",{style:{marginBottom:"1rem",display:"flex",gap:"8px"},children:[e.jsxs("form",{onSubmit:q,style:{flex:1,display:"flex",gap:"8px"},children:[e.jsx("input",{type:"text",placeholder:"Search opportunities...",className:"search-input-compact",value:Z,onChange:ze,style:{flex:1}}),Z&&e.jsx(C,{type:"button",variant:"outline",onClick:je,style:{padding:"0 12px"},children:e.jsx(be,{size:18})}),e.jsx(C,{type:"submit",variant:"outline",disabled:p,children:p?"Searching...":"Search"})]}),e.jsxs(C,{variant:"outline",icon:e.jsx(ot,{size:18}),onClick:()=>x(!0),children:["Filter",Object.keys(d).length>0&&e.jsx("span",{style:{marginLeft:"6px",padding:"2px 6px",background:"#3b82f6",color:"white",borderRadius:"10px",fontSize:"11px",fontWeight:"600"},children:Object.keys(d).length})]})]}),e.jsx("div",{className:"table-container",children:p?e.jsxs("div",{style:{padding:"2rem",textAlign:"center",color:"#64748b"},children:[e.jsx(Xe,{}),e.jsx("div",{style:{marginTop:"8px"},children:"Searching..."})]}):e.jsxs("table",{className:"data-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Opportunity Name"}),e.jsx("th",{children:"Account"}),e.jsx("th",{children:"Stage"}),e.jsx("th",{children:"Amount"}),e.jsx("th",{children:"Probability"}),e.jsx("th",{children:"Expected Revenue"}),e.jsx("th",{children:"Close Date"}),e.jsx("th",{children:"Owner"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:n.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"9",style:{textAlign:"center",padding:"2rem"},children:M?"No opportunities found matching your search.":'No opportunities found. Click "Add Opportunity" to create one.'})}):n.map(l=>{const S=typeof l.amount=="number"?l.amount:parseFloat(String(l.amount).replace(/[$,]/g,""))||0,c=Math.round(S*(l.probability||0)/100);return e.jsxs("tr",{children:[e.jsx("td",{className:"font-semibold",children:l.name}),e.jsx("td",{children:l.account_name||l.account||"N/A"}),e.jsx("td",{children:e.jsx("span",{className:"stage-badge",style:{background:`${ue[l.stage]||"#64748b"}20`,color:ue[l.stage]||"#64748b"},children:l.stage})}),e.jsx("td",{className:"font-semibold",children:h(S)}),e.jsx("td",{children:e.jsxs("div",{className:"probability-cell",children:[e.jsx("div",{className:"probability-bar-bg",children:e.jsx("div",{className:"probability-bar",style:{width:`${l.probability||0}%`,background:ue[l.stage]||"#64748b"}})}),e.jsxs("span",{children:[l.probability||0,"%"]})]})}),e.jsx("td",{className:"text-success font-semibold",children:h(c)}),e.jsx("td",{children:l.close_date?new Date(l.close_date).toLocaleDateString():"N/A"}),e.jsx("td",{children:l.owner||"Unassigned"}),e.jsxs("td",{className:"actions-cell",children:[e.jsx("button",{className:"action-btn",title:"Edit",onClick:()=>Fe(l),children:e.jsx(it,{size:16})}),e.jsx("button",{className:"action-btn danger",title:"Delete",onClick:()=>Ce(l.id),disabled:X&&T?.id===l.id,children:e.jsx(Je,{size:16})})]})]},l.id)})})]})}),!k&&!j&&!p&&L>0&&e.jsx(at,{currentPage:F,totalPages:I,pageSize:W,total:L,onPageChange:Ne,onPageSizeChange:$e})]})]}),V&&e.jsx("div",{className:"modal-overlay",onClick:Pe,children:e.jsxs("div",{className:"modal-content",onClick:l=>l.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"Add New Opportunity"}),e.jsx("button",{className:"modal-close",onClick:Pe,children:e.jsx(be,{size:24})})]}),e.jsxs("form",{onSubmit:Ee,className:"modal-form",children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"name",children:["Opportunity Name ",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("input",{type:"text",id:"name",name:"name",value:w.name,onChange:ke,className:D.name?"error":"",placeholder:"Enter opportunity name"}),D.name&&e.jsx("span",{className:"error-message",children:D.name})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"account",children:["Account ",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("input",{type:"text",id:"account",name:"account",value:w.account,onChange:ke,className:D.account?"error":"",placeholder:"Enter account name"}),D.account&&e.jsx("span",{className:"error-message",children:D.account})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"value",children:["Value ($) ",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("input",{type:"number",id:"value",name:"value",value:w.value,onChange:ke,className:D.value?"error":"",placeholder:"Enter opportunity value",step:"0.01",min:"0"}),D.value&&e.jsx("span",{className:"error-message",children:D.value})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"stage",children:"Stage"}),e.jsxs("select",{id:"stage",name:"stage",value:w.stage,onChange:ke,children:[e.jsx("option",{value:"Prospecting",children:"Prospecting"}),e.jsx("option",{value:"Qualification",children:"Qualification"}),e.jsx("option",{value:"Proposal",children:"Proposal"}),e.jsx("option",{value:"Negotiation",children:"Negotiation"}),e.jsx("option",{value:"Closed Won",children:"Closed Won"}),e.jsx("option",{value:"Closed Lost",children:"Closed Lost"})]})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"probability",children:"Probability (%)"}),e.jsx("input",{type:"number",id:"probability",name:"probability",value:w.probability,onChange:ke,className:D.probability?"error":"",placeholder:"Enter probability (0-100)",min:"0",max:"100"}),D.probability&&e.jsx("span",{className:"error-message",children:D.probability})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"close_date",children:"Expected Close Date"}),e.jsx("input",{type:"date",id:"close_date",name:"close_date",value:w.close_date,onChange:ke})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"owner",children:"Owner"}),e.jsx("input",{type:"text",id:"owner",name:"owner",value:w.owner,onChange:ke,placeholder:"Enter owner name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"contact_id",children:"Contact ID (Optional)"}),e.jsx("input",{type:"number",id:"contact_id",name:"contact_id",value:w.contact_id,onChange:ke,placeholder:"Enter contact ID",min:"1"})]})]}),D.submit&&e.jsx("div",{className:"error-message submit-error",children:D.submit}),e.jsxs("div",{className:"modal-actions",children:[e.jsx(C,{type:"button",variant:"secondary",onClick:Pe,children:"Cancel"}),e.jsx(C,{type:"submit",disabled:se,children:se?"Creating...":"Create Opportunity"})]})]})]})}),e.jsx(st,{isOpen:R,onClose:()=>$(!1),onUpload:_e,onDownloadTemplate:ve,onGetProgress:fe,title:"Upload Opportunities from Excel",entityName:"opportunities"}),e.jsx(mt,{isOpen:v,onClose:()=>x(!1),onApply:De,filters:d,filterConfigs:J}),ee&&e.jsx("div",{className:"edit-opportunity-overlay",onClick:Oe,children:e.jsxs("div",{className:"edit-opportunity-modal",onClick:l=>l.stopPropagation(),children:[e.jsxs("div",{className:"edit-opportunity-header",children:[e.jsx("h2",{className:"edit-opportunity-title",children:"Edit Opportunity"}),e.jsx("button",{className:"modal-close",onClick:Oe,children:e.jsx(be,{size:24})})]}),e.jsxs("form",{onSubmit:l=>{l.preventDefault(),ge(ee)},className:"edit-opportunity-form",children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"edit_name",children:["Opportunity Name ",e.jsx("span",{style:{color:"#ef4444"},children:"*"})]}),e.jsx("input",{type:"text",id:"edit_name",name:"name",value:u.name,onChange:pe,placeholder:"Enter opportunity name",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"edit_account",children:["Account ",e.jsx("span",{style:{color:"#ef4444"},children:"*"})]}),e.jsx("input",{type:"text",id:"edit_account",name:"account",value:u.account,onChange:pe,placeholder:"Enter account name",required:!0})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"edit_value",children:["Value ($) ",e.jsx("span",{style:{color:"#ef4444"},children:"*"})]}),e.jsx("input",{type:"number",id:"edit_value",name:"value",value:u.value,onChange:pe,placeholder:"Enter opportunity value",step:"0.01",min:"0",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit_stage",children:"Stage"}),e.jsxs("select",{id:"edit_stage",name:"stage",value:u.stage,onChange:pe,children:[e.jsx("option",{value:"Prospecting",children:"Prospecting"}),e.jsx("option",{value:"Qualification",children:"Qualification"}),e.jsx("option",{value:"Proposal",children:"Proposal"}),e.jsx("option",{value:"Negotiation",children:"Negotiation"}),e.jsx("option",{value:"Closed Won",children:"Closed Won"}),e.jsx("option",{value:"Closed Lost",children:"Closed Lost"})]})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"edit_probability",children:["Probability (%) ",e.jsx("span",{style:{color:"#ef4444"},children:"*"})]}),e.jsx("input",{type:"number",id:"edit_probability",name:"probability",value:u.probability,onChange:pe,placeholder:"Enter probability (0-100)",min:"0",max:"100",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit_close_date",children:"Expected Close Date"}),e.jsx("input",{type:"date",id:"edit_close_date",name:"close_date",value:u.close_date,onChange:pe})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit_owner",children:"Owner"}),e.jsx("input",{type:"text",id:"edit_owner",name:"owner",value:u.owner,onChange:pe,placeholder:"Enter owner name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit_contact_id",children:"Contact ID (Optional)"}),e.jsx("input",{type:"number",id:"edit_contact_id",name:"contact_id",value:u.contact_id,onChange:pe,placeholder:"Enter contact ID",min:"1"})]})]}),e.jsxs("div",{className:"edit-opportunity-footer",children:[e.jsx(C,{type:"button",variant:"outline",onClick:Oe,disabled:we,children:"Cancel"}),e.jsx(C,{type:"submit",disabled:we,children:we?"Saving...":"Save Changes"})]})]})]})}),e.jsx(ut,{isOpen:_,onClose:a,onConfirm:Le,title:"Delete Opportunity",message:T?`Are you sure you want to delete "${T.name}"? This action cannot be undone.`:"Are you sure you want to delete this opportunity?",confirmText:"Delete",cancelText:"Cancel",type:"danger",loading:X})]})},ea=()=>{const t=dt(),[n,i]=s.useState([]),[k,f]=s.useState(!0),[p,g]=s.useState(!1),[j,N]=s.useState(null),[V,U]=s.useState(!1),[R,$]=s.useState(!1),[v,x]=s.useState(!1),[_,G]=s.useState({}),[T,O]=s.useState(1),[X,ie]=s.useState(20),[d,Q]=s.useState(0),[F,E]=s.useState(0),[W,te]=s.useState(""),[I,y]=s.useState(""),[L,H]=s.useState(null),[M,Y]=s.useState({name:"",industry:"",revenue:"",employees:"",location:"",phone:"",website:"",account_owner:"",status:"Active"}),[Z,re]=s.useState(!1),[z,oe]=s.useState(null),[ee,le]=s.useState(null),[u,A]=s.useState({}),[we,ae]=s.useState(!1),[w,ne]=s.useState(!1),[D,ce]=s.useState(null),[se,xe]=s.useState(!1),[de,ze]=s.useState(!1),[q,je]=s.useState(null);s.useEffect(()=>{Ne()},[T,X,W,_]),s.useEffect(()=>()=>{L&&clearTimeout(L)},[L]);const Ne=async()=>{try{n.length===0&&!W?f(!0):g(!0),N(null);const c={page:T,page_size:X};W&&(c.search=W),_.status&&_.status.length>0&&(c.status=_.status.join(",")),_.industry&&_.industry.length>0&&(c.industry=_.industry.join(",")),_.location&&_.location.length>0&&(c.location=_.location.join(",")),_.account_owner&&_.account_owner.length>0&&(c.account_owner=_.account_owner.join(",")),_.employees?.min&&(c.employees_min=_.employees.min),_.employees?.max&&(c.employees_max=_.employees.max);const B=await Ge.getAll(c);i(B.items||[]),Q(B.total_pages||0),E(B.total||0)}catch(c){console.error("Error fetching accounts:",c),N("Failed to load accounts. Please try again.")}finally{f(!1),g(!1)}},$e=c=>{const B=c.target.value;y(B),L&&clearTimeout(L);const o=setTimeout(()=>{te(B),T!==1&&O(1)},500);H(o)},ke=c=>{c.preventDefault(),L&&clearTimeout(L),te(I),T!==1&&O(1)},Ae=()=>{y(""),te(""),T!==1&&O(1),L&&clearTimeout(L)},Ee=c=>{O(c)},Pe=c=>{ie(c),O(1)},_e=()=>{U(!0),oe(null)},fe=()=>{U(!1),Y({name:"",industry:"",revenue:"",employees:"",location:"",phone:"",website:"",account_owner:"",status:"Active"}),oe(null)},ve=c=>{const{name:B,value:o}=c.target;Y(K=>({...K,[B]:o}))},De=async c=>{if(c.preventDefault(),oe(null),!M.name.trim()){oe("Account name is required");return}try{re(!0);const B={name:M.name.trim(),industry:M.industry.trim()||null,revenue:M.revenue.trim()||null,employees:M.employees?parseInt(M.employees):null,location:M.location.trim()||null,phone:M.phone.trim()||null,website:M.website.trim()||null,account_owner:M.account_owner.trim()||null,status:M.status};await Ge.create(B),await Ne(),fe(),t.success("Account created successfully!")}catch(B){console.error("Error creating account:",B);const o=B.message||"Failed to create account";oe(o),t.error(o)}finally{re(!1)}},Fe=async(c,B=!1)=>{try{t.info("Uploading file...");const o=await Ge.bulkUpload(c,B);return o.async?t.success("Upload started in background. Track progress in the modal."):(await Ne(),o.success_count>0&&t.success(`Successfully uploaded ${o.success_count} accounts!`),o.failed_count>0&&t.warning(`${o.failed_count} records failed to upload. Check the error details.`)),o}catch(o){throw console.error("Error uploading Excel file:",o),t.error(o.message||"Failed to upload file. Please try again."),o}},Oe=async c=>{try{const B=await Ge.getUploadProgress(c);return B.status==="completed"?(await Ne(),B.success_count>0&&t.success(`Successfully uploaded ${B.success_count} accounts!`),B.failed_count>0&&t.warning(`${B.failed_count} records failed. Check the error details.`)):B.status==="failed"&&t.error("Upload failed. Please try again."),B}catch(B){throw console.error("Error getting upload progress:",B),t.error("Failed to get upload progress."),B}},pe=async()=>{try{await Ge.downloadTemplate()}catch(c){throw console.error("Error downloading template:",c),c}},ge=c=>{je(c),ze(!0)},Ce=()=>{ze(!1),je(null)},Le=c=>{le(c.id),A({name:c.name||"",industry:c.industry||"",revenue:c.annual_revenue||c.revenue||"",employees:c.number_of_employees||c.employees||"",location:c.billing_city?`${c.billing_city}, ${c.billing_state||""}`:c.location||"",phone:c.phone||"",website:c.website||"",account_owner:c.owner||c.account_owner||"",status:c.status||"Active"})},a=()=>{le(null),A({})},r=c=>{const{name:B,value:o}=c.target;A(K=>({...K,[B]:o}))},P=async c=>{if(!u.name||!u.name.trim()){t.error("Account name is required");return}ae(!0);try{const B={name:u.name.trim(),industry:u.industry.trim()||null,revenue:u.revenue.trim()||null,employees:u.employees?parseInt(u.employees):null,location:u.location.trim()||null,phone:u.phone.trim()||null,website:u.website.trim()||null,account_owner:u.account_owner.trim()||null,status:u.status},o=await Ge.update(c,B);i(n.map(K=>K.id===c?{...K,...o}:K)),le(null),A({}),t.success("Account updated successfully!")}catch(B){console.error("Error updating account:",B),t.error(B.message||"Failed to update account")}finally{ae(!1)}},J=async c=>{const B=n.find(o=>o.id===c);ce(B),ne(!0)},ue=async()=>{if(D){xe(!0);try{await Ge.delete(D.id),i(n.filter(c=>c.id!==D.id)),E(c=>c-1),ne(!1),ce(null),t.success("Account deleted successfully!")}catch(c){console.error("Error deleting account:",c),t.error("Failed to delete account. Please try again.")}finally{xe(!1)}}},Te=()=>{ne(!1),ce(null)},Ue=c=>{G(c),O(1)};let h=null;const l=async()=>(h||(h=await Ge.getFilterOptions()),h),S=[{key:"status",label:"Status",type:"multiselect",icon:e.jsx(Ke,{size:16}),loadOptions:async()=>(await l()).status||[]},{key:"industry",label:"Industry",type:"multiselect",icon:e.jsx(gs,{size:16}),loadOptions:async()=>(await l()).industry||[]},{key:"location",label:"Location",type:"multiselect",icon:e.jsx(jt,{size:16}),loadOptions:async()=>(await l()).location||[]},{key:"account_owner",label:"Account Owner",type:"multiselect",icon:e.jsx(Dt,{size:16}),loadOptions:async()=>(await l()).account_owner||[]},{key:"employees",label:"Employees",type:"range",icon:e.jsx(Ye,{size:16})}];return e.jsxs("div",{className:"accounts-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"page-title",children:"Accounts"}),e.jsx("p",{className:"page-subtitle",children:"Manage your business accounts and customer organizations"})]}),e.jsxs("div",{style:{display:"flex",gap:"12px"},children:[e.jsx(C,{icon:e.jsx(qe,{size:18}),onClick:()=>$(!0),variant:"outline",children:"Upload Excel"}),e.jsx(C,{icon:e.jsx(tt,{size:18}),onClick:_e,children:"Add Account"})]})]}),e.jsx("div",{style:{marginBottom:"1rem"},children:e.jsxs("form",{onSubmit:ke,style:{display:"flex",gap:"8px",maxWidth:"100%"},children:[e.jsx("input",{type:"text",placeholder:"Search accounts...",className:"search-input-compact",value:I,onChange:$e,style:{flex:1}}),I&&e.jsx(C,{type:"button",variant:"outline",onClick:Ae,style:{padding:"0 12px"},children:e.jsx(be,{size:18})}),e.jsx(C,{type:"submit",variant:"outline",disabled:p,children:p?"Searching...":"Search"}),e.jsxs(C,{variant:"outline",icon:e.jsx(ot,{size:18}),onClick:()=>x(!0),children:["Filter",Object.keys(_).length>0&&e.jsx("span",{style:{marginLeft:"6px",padding:"2px 6px",background:"#3b82f6",color:"white",borderRadius:"10px",fontSize:"11px",fontWeight:"600"},children:Object.keys(_).length})]})]})}),e.jsx("div",{className:"accounts-grid",children:k?e.jsx("div",{style:{gridColumn:"1 / -1"},children:e.jsx(yt,{count:6,size:"large"})}):j?e.jsx(he,{style:{gridColumn:"1 / -1"},children:e.jsxs("div",{className:"error-state-container",children:[e.jsx("div",{className:"error-state-message",children:j}),e.jsx(C,{onClick:Ne,className:"error-state-retry-button",children:"Retry"})]})}):p?e.jsxs("div",{style:{gridColumn:"1 / -1",padding:"3rem",textAlign:"center",background:"var(--surface)",borderRadius:"12px"},children:[e.jsx(Xe,{}),e.jsx("div",{style:{marginTop:"12px",fontSize:"14px",color:"#64748b"},children:"Searching accounts..."})]}):n.length===0?e.jsx(he,{style:{gridColumn:"1 / -1"},children:e.jsxs("div",{style:{padding:"3rem",textAlign:"center",color:"#64748b"},children:[e.jsx(rt,{size:48,style:{margin:"0 auto 16px",opacity:.3}}),e.jsx("div",{style:{fontSize:"16px",fontWeight:"600",marginBottom:"8px"},children:W?"No accounts found":"No accounts yet"}),e.jsx("div",{style:{fontSize:"14px"},children:W?"Try adjusting your search or filters.":'Click "Add Account" to create your first account.'})]})}):n.map(c=>e.jsxs(he,{className:"account-card",children:[e.jsxs("div",{className:"account-header",children:[e.jsx("div",{className:"account-icon",children:e.jsx(rt,{size:32})}),e.jsx("span",{className:`account-status ${(c.status||"active").toLowerCase()}`,children:c.status||"Active"})]}),e.jsx("h3",{className:"account-name",children:c.name}),e.jsx("p",{className:"account-industry",children:c.industry||"N/A"}),e.jsxs("div",{className:"account-details",children:[e.jsxs("div",{className:"detail-row",children:[e.jsx(ct,{size:16}),e.jsxs("span",{children:["Annual Revenue: ",c.annual_revenue||c.revenue||"N/A"]})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx(Ye,{size:16}),e.jsxs("span",{children:["Employees: ",c.number_of_employees||c.employees||"N/A"]})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx(jt,{size:16}),e.jsx("span",{children:c.billing_city?`${c.billing_city}, ${c.billing_state||""}`:c.location||"N/A"})]})]}),e.jsxs("div",{className:"account-footer",children:[e.jsxs("span",{className:"owner-label",children:["Owner: ",c.account_owner||"Unassigned"]}),e.jsxs("div",{className:"card-actions",children:[e.jsx("button",{className:"action-btn",title:"View Details",onClick:()=>ge(c),children:e.jsx(xs,{size:16})}),e.jsx("button",{className:"action-btn",title:"Edit",onClick:()=>Le(c),children:e.jsx(it,{size:16})}),e.jsx("button",{className:"action-btn danger",title:"Delete",onClick:()=>J(c.id),disabled:se&&D?.id===c.id,children:e.jsx(Je,{size:16})})]})]})]},c.id))}),!k&&!j&&!p&&F>0&&e.jsx(at,{currentPage:T,totalPages:d,pageSize:X,total:F,onPageChange:Ee,onPageSizeChange:Pe}),V&&e.jsx("div",{className:"modal-overlay",onClick:fe,children:e.jsxs("div",{className:"modal",onClick:c=>c.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{className:"modal-title",children:"Add Account"}),e.jsx("button",{className:"close-button",onClick:fe,children:e.jsx(be,{size:18})})]}),e.jsxs("form",{className:"modal-form",onSubmit:De,children:[z&&e.jsx("div",{className:"form-error",children:z}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"name",children:"Account Name"}),e.jsx("input",{type:"text",id:"name",name:"name",value:M.name,onChange:ve,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"industry",children:"Industry"}),e.jsx("input",{type:"text",id:"industry",name:"industry",value:M.industry,onChange:ve})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"revenue",children:"Annual Revenue"}),e.jsx("input",{type:"text",id:"revenue",name:"revenue",value:M.revenue,onChange:ve})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"employees",children:"Employees"}),e.jsx("input",{type:"text",id:"employees",name:"employees",value:M.employees,onChange:ve})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"location",children:"Location"}),e.jsx("input",{type:"text",id:"location",name:"location",value:M.location,onChange:ve})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"phone",children:"Phone"}),e.jsx("input",{type:"text",id:"phone",name:"phone",value:M.phone,onChange:ve})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"website",children:"Website"}),e.jsx("input",{type:"text",id:"website",name:"website",value:M.website,onChange:ve})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"account_owner",children:"Account Owner"}),e.jsx("input",{type:"text",id:"account_owner",name:"account_owner",value:M.account_owner,onChange:ve})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"status",children:"Status"}),e.jsxs("select",{id:"status",name:"status",value:M.status,onChange:ve,children:[e.jsx("option",{value:"Active",children:"Active"}),e.jsx("option",{value:"Inactive",children:"Inactive"})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx(C,{type:"button",variant:"outline",onClick:fe,children:"Cancel"}),e.jsx(C,{type:"submit",loading:Z,children:"Create Account"})]})]})]})}),e.jsx(st,{isOpen:R,onClose:()=>$(!1),onUpload:Fe,onDownloadTemplate:pe,onGetProgress:Oe,title:"Upload Accounts from Excel",entityName:"accounts"}),ee&&e.jsx("div",{className:"modal-overlay",onClick:a,children:e.jsxs("div",{className:"modal",onClick:c=>c.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{className:"modal-title",children:"Edit Account"}),e.jsx("button",{className:"close-button",onClick:a,children:e.jsx(be,{size:18})})]}),e.jsxs("form",{className:"modal-form",onSubmit:c=>{c.preventDefault(),P(ee)},children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"edit-name",children:["Account Name ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{type:"text",id:"edit-name",name:"name",value:u.name,onChange:r,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit-industry",children:"Industry"}),e.jsx("input",{type:"text",id:"edit-industry",name:"industry",value:u.industry,onChange:r})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit-revenue",children:"Annual Revenue"}),e.jsx("input",{type:"text",id:"edit-revenue",name:"revenue",value:u.revenue,onChange:r})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit-employees",children:"Employees"}),e.jsx("input",{type:"text",id:"edit-employees",name:"employees",value:u.employees,onChange:r})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit-location",children:"Location"}),e.jsx("input",{type:"text",id:"edit-location",name:"location",value:u.location,onChange:r})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit-phone",children:"Phone"}),e.jsx("input",{type:"text",id:"edit-phone",name:"phone",value:u.phone,onChange:r})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit-website",children:"Website"}),e.jsx("input",{type:"text",id:"edit-website",name:"website",value:u.website,onChange:r})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit-account_owner",children:"Account Owner"}),e.jsx("input",{type:"text",id:"edit-account_owner",name:"account_owner",value:u.account_owner,onChange:r})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit-status",children:"Status"}),e.jsxs("select",{id:"edit-status",name:"status",value:u.status,onChange:r,children:[e.jsx("option",{value:"Active",children:"Active"}),e.jsx("option",{value:"Inactive",children:"Inactive"})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx(C,{type:"button",variant:"outline",onClick:a,children:"Cancel"}),e.jsx(C,{type:"submit",loading:we,children:"Save Changes"})]})]})]})}),de&&q&&e.jsx("div",{className:"modal-overlay",onClick:Ce,children:e.jsxs("div",{className:"modal details-modal",onClick:c=>c.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{className:"modal-title",children:"Account Details"}),e.jsx("button",{className:"close-button",onClick:Ce,children:e.jsx(be,{size:18})})]}),e.jsxs("div",{className:"details-content",children:[e.jsxs("div",{className:"details-header",children:[e.jsx("div",{className:"account-icon",children:e.jsx(rt,{size:32})}),e.jsxs("div",{children:[e.jsx("h3",{className:"details-account-name",children:q.name}),e.jsx("span",{className:`account-status ${(q.status||"active").toLowerCase()}`,children:q.status||"Active"})]})]}),e.jsxs("div",{className:"details-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"Industry:"}),e.jsx("span",{className:"detail-value",children:q.industry||"N/A"})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"Annual Revenue:"}),e.jsx("span",{className:"detail-value",children:q.annual_revenue||q.revenue||"N/A"})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"Employees:"}),e.jsx("span",{className:"detail-value",children:q.number_of_employees||q.employees||"N/A"})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"Location:"}),e.jsx("span",{className:"detail-value",children:q.billing_city?`${q.billing_city}, ${q.billing_state||""}`:q.location||"N/A"})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"Phone:"}),e.jsx("span",{className:"detail-value",children:q.phone||"N/A"})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"Website:"}),e.jsx("span",{className:"detail-value",children:q.website||"N/A"})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"Account Owner:"}),e.jsx("span",{className:"detail-value",children:q.owner||"Unassigned"})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"Contacts:"}),e.jsx("span",{className:"detail-value",children:q.contacts||0})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"Opportunities:"}),e.jsx("span",{className:"detail-value",children:q.opportunities||0})]})]}),e.jsxs("div",{className:"details-actions",children:[e.jsx(C,{icon:e.jsx(it,{size:16}),onClick:()=>{Le(q),Ce()},variant:"outline",children:"Edit Account"}),e.jsx(C,{icon:e.jsx(Je,{size:16}),onClick:()=>{Ce(),J(q.id)},variant:"outline",style:{color:"#ef4444",borderColor:"#ef4444"},children:"Delete Account"})]})]})]})}),e.jsx(mt,{isOpen:v,onClose:()=>x(!1),onApply:Ue,filters:_,filterConfigs:S}),e.jsx(ut,{isOpen:w,onClose:Te,onConfirm:ue,title:"Delete Account",message:D?`Are you sure you want to delete "${D.name}"? This action cannot be undone.`:"Are you sure you want to delete this account?",confirmText:"Delete",cancelText:"Cancel",type:"danger",loading:se})]})},ta=({status:t,children:n,count:i})=>{const{setNodeRef:k,isOver:f}=ks({id:t});return e.jsxs("div",{className:"kanban-column",children:[e.jsxs("div",{className:"column-header",children:[e.jsx("h3",{children:t}),e.jsx("span",{className:"task-count",children:i})]}),e.jsx("div",{ref:k,className:`column-content ${f?"drag-over":""}`,children:n})]})},sa=({task:t,priorityColors:n,statusIcons:i,onEdit:k,onDelete:f})=>{const{attributes:p,listeners:g,setNodeRef:j,transform:N,transition:V,isDragging:U}=_s({id:t.id}),R={transform:Es.Transform.toString(N),transition:V,opacity:U?.5:1},$=["Open","In Progress","Completed","Closed"].includes(t.status)?t.status==="Open"?"To Do":t.status==="Closed"?"Completed":t.status:t.status,v=i[$]||Lt;return e.jsxs("div",{ref:j,style:R,className:`task-card ${$==="Completed"?"completed":""}`,children:[e.jsxs("div",{className:"task-header",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("div",{...p,...g,className:"drag-handle",children:e.jsx(Ds,{size:16})}),e.jsx(v,{size:20,className:`task-status-icon ${$==="In Progress"?"in-progress":$==="Completed"?"completed":""}`})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("span",{className:"task-priority",style:{background:`${n[t.priority]||"#64748b"}20`,color:n[t.priority]||"#64748b"},children:t.priority||"Medium"}),e.jsx("button",{className:"task-action-btn",onClick:x=>{x.stopPropagation(),k(t)},title:"Edit task",children:e.jsx(Ut,{size:16})}),e.jsx("button",{className:"task-action-btn delete",onClick:x=>{x.stopPropagation(),f(t)},title:"Delete task",children:e.jsx(Je,{size:16})})]})]}),e.jsx("h4",{className:"task-title",children:t.title||t.subject}),e.jsx("p",{className:"task-description",children:t.description}),e.jsxs("div",{className:"task-meta",children:[e.jsxs("span",{className:"task-due",children:["Due: ",t.due_date?new Date(t.due_date).toLocaleDateString():"N/A"]}),e.jsx("span",{className:"task-related",children:t.related_to||"N/A"})]}),e.jsx("div",{className:"task-assignee",children:t.assigned_to||"Unassigned"})]})},aa=()=>{const[t,n]=s.useState([]),[i,k]=s.useState(!0),[f,p]=s.useState(!1),[g,j]=s.useState(null),[N,V]=s.useState(!1),[U,R]=s.useState(!1),[$,v]=s.useState(!1),[x,_]=s.useState({}),[G,T]=s.useState(!1),[O,X]=s.useState(1),[ie,d]=s.useState(20),[Q,F]=s.useState(0),[E,W]=s.useState(0),[te,I]=s.useState(""),[y,L]=s.useState(""),[H,M]=s.useState(null),[Y,Z]=s.useState(null),[re,z]=s.useState(null),[oe,ee]=s.useState(!1),[le,u]=s.useState(null),[A,we]=s.useState({title:"",description:"",priority:"Medium",status:"To Do",due_date:"",assigned_to:"",related_to:"",contact_id:""}),ae=js(fs(ws,{activationConstraint:{distance:8}}));s.useEffect(()=>{w()},[O,ie,te,x]),s.useEffect(()=>()=>{H&&clearTimeout(H)},[H]);const w=async()=>{try{t.length===0&&!te?k(!0):p(!0),j(null);const a={page:O,page_size:ie};te&&(a.search=te),x.status&&x.status.length>0&&(a.status=x.status.join(",")),x.priority&&x.priority.length>0&&(a.priority=x.priority.join(",")),x.assigned_to&&x.assigned_to.length>0&&(a.assigned_to=x.assigned_to.join(",")),x.related_to&&x.related_to.length>0&&(a.related_to=x.related_to.join(",")),x.due_date?.start&&(a.due_date_start=x.due_date.start),x.due_date?.end&&(a.due_date_end=x.due_date.end);const r=await Ve.getAll(a);n(r.items||[]),F(r.total_pages||0),W(r.total||0)}catch(a){console.error("Error fetching tasks:",a),j("Failed to load tasks. Please try again.")}finally{k(!1),p(!1)}},ne=a=>{const r=a.target.value;L(r),H&&clearTimeout(H);const P=setTimeout(()=>{I(r),O!==1&&X(1)},500);M(P)},D=a=>{a.preventDefault(),H&&clearTimeout(H),I(y),O!==1&&X(1)},ce=()=>{L(""),I(""),O!==1&&X(1),H&&clearTimeout(H)},se=a=>{X(a)},xe=a=>{d(a),X(1)},de={High:"#ef4444",Medium:"#f59e0b",Low:"#64748b"},ze={"To Do":Lt,"In Progress":Cs,Completed:kt},q=a=>({Open:"To Do","In Progress":"In Progress",Completed:"Completed",Closed:"Completed"})[a]||a,je=a=>t.filter(r=>q(r.status)===a),Ne=a=>{const{name:r,value:P}=a.target;we(J=>({...J,[r]:P}))},$e=async a=>{if(a.preventDefault(),!A.title.trim()){alert("Please enter a task title");return}try{T(!0);const r={title:A.title,description:A.description||null,priority:A.priority,status:A.status,due_date:A.due_date||null,assigned_to:A.assigned_to||null,related_to:A.related_to||null,contact_id:A.contact_id?parseInt(A.contact_id):null};re?await Ve.update(re.id,r):await Ve.create(r),we({title:"",description:"",priority:"Medium",status:"To Do",due_date:"",assigned_to:"",related_to:"",contact_id:""}),z(null),V(!1),await w()}catch(r){console.error("Error saving task:",r),alert(r.message||"Failed to save task. Please try again.")}finally{T(!1)}},ke=()=>{V(!1),z(null),we({title:"",description:"",priority:"Medium",status:"To Do",due_date:"",assigned_to:"",related_to:"",contact_id:""})},Ae=a=>{Z(a.active.id)},Ee=async a=>{const{active:r,over:P}=a;if(Z(null),!P)return;const J=r.id;let ue=P.id;if(typeof ue=="number"){const h=t.find(l=>l.id===ue);if(h)ue=q(h.status);else{console.error("Target task not found:",ue);return}}if(typeof ue!="string"||!["To Do","In Progress","Completed"].includes(ue)){console.error("Invalid drop target:",ue);return}const Te=t.find(h=>h.id===J);if(!Te){console.error("Task not found:",J);return}if(q(Te.status)!==ue)try{n(h=>h.map(l=>l.id===J?{...l,status:ue}:l)),await Ve.update(J,{status:ue})}catch(h){console.error("Error updating task status:",h),await w(),alert("Failed to update task status. Please try again.")}},Pe=a=>{z(a),we({title:a.title||a.subject||"",description:a.description||"",priority:a.priority||"Medium",status:q(a.status),due_date:a.due_date||"",assigned_to:a.assigned_to||"",related_to:a.related_to||"",contact_id:a.contact_id||""}),V(!0)},_e=a=>{u(a),ee(!0)},fe=async()=>{if(le)try{T(!0),await Ve.delete(le.id),ee(!1),u(null),await w()}catch(a){console.error("Error deleting task:",a),alert("Failed to delete task. Please try again.")}finally{T(!1)}},ve=()=>{ee(!1),u(null)},De=async(a,r=!1)=>{try{const P=await Ve.bulkUpload(a,r);return P.async||await w(),P}catch(P){throw console.error("Error uploading Excel file:",P),P}},Fe=async a=>{try{const r=await Ve.getUploadProgress(a);return r.status==="completed"&&await w(),r}catch(r){throw console.error("Error getting upload progress:",r),r}},Oe=async()=>{try{await Ve.downloadTemplate()}catch(a){throw console.error("Error downloading template:",a),a}},pe=a=>{_(a),X(1)};let ge=null;const Ce=async()=>(ge||(ge=await Ve.getFilterOptions()),ge),Le=[{key:"status",label:"Status",type:"multiselect",icon:e.jsx(Ke,{size:16}),loadOptions:async()=>(await Ce()).status||["To Do","In Progress","Completed"]},{key:"priority",label:"Priority",type:"multiselect",icon:e.jsx(Ke,{size:16}),loadOptions:async()=>(await Ce()).priority||["Low","Medium","High"]},{key:"assigned_to",label:"Assigned To",type:"multiselect",icon:e.jsx(Dt,{size:16}),loadOptions:async()=>(await Ce()).assigned_to||[]},{key:"related_to",label:"Related To",type:"multiselect",icon:e.jsx(Ke,{size:16}),loadOptions:async()=>(await Ce()).related_to||[]},{key:"due_date",label:"Due Date",type:"daterange",icon:e.jsx($t,{size:16})}];return je("To Do"),je("In Progress"),je("Completed"),e.jsxs("div",{className:"tasks-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"page-title",children:"Tasks"}),e.jsx("p",{className:"page-subtitle",children:"Manage and track your daily activities and follow-ups"})]}),e.jsxs("div",{style:{display:"flex",gap:"12px"},children:[e.jsx(C,{icon:e.jsx(qe,{size:18}),onClick:()=>R(!0),variant:"outline",children:"Upload Excel"}),e.jsx(C,{icon:e.jsx(tt,{size:18}),onClick:()=>V(!0),children:"Add Task"})]})]}),e.jsx("div",{style:{marginBottom:"1rem"},children:e.jsxs("form",{onSubmit:D,style:{display:"flex",gap:"8px",maxWidth:"100%"},children:[e.jsx("input",{type:"text",placeholder:"Search tasks...",className:"search-input-compact",value:y,onChange:ne,style:{flex:1}}),y&&e.jsx(C,{type:"button",variant:"outline",onClick:ce,style:{padding:"0 12px"},children:e.jsx(be,{size:18})}),e.jsx(C,{type:"submit",variant:"outline",disabled:f,children:f?"Searching...":"Search"}),e.jsxs(C,{variant:"outline",icon:e.jsx(ot,{size:18}),onClick:()=>v(!0),children:["Filter",Object.keys(x).length>0&&e.jsx("span",{style:{marginLeft:"6px",padding:"2px 6px",background:"#3b82f6",color:"white",borderRadius:"10px",fontSize:"11px",fontWeight:"600"},children:Object.keys(x).length})]})]})}),i?e.jsx(Gs,{}):g?e.jsx(he,{children:e.jsxs("div",{className:"error-state-container",children:[e.jsx("div",{className:"error-state-message",children:g}),e.jsx(C,{onClick:w,className:"error-state-retry-button",children:"Retry"})]})}):f?e.jsx(he,{children:e.jsxs("div",{style:{padding:"2rem",textAlign:"center",color:"#64748b"},children:[e.jsx(Xe,{}),e.jsx("div",{style:{marginTop:"8px"},children:"Searching..."})]})}):e.jsxs(vs,{sensors:ae,collisionDetection:ys,onDragStart:Ae,onDragEnd:Ee,children:[e.jsx("div",{className:"tasks-kanban",children:["To Do","In Progress","Completed"].map(a=>{const r=je(a);return e.jsx(ta,{status:a,count:r.length,children:e.jsx(bs,{id:a,items:r.map(P=>P.id),strategy:Ns,children:r.length===0?e.jsx("div",{style:{padding:"1rem",textAlign:"center",color:"#64748b"},children:"No tasks"}):r.map(P=>e.jsx(sa,{task:P,priorityColors:de,statusIcons:ze,onEdit:Pe,onDelete:_e},P.id))})},a)})}),e.jsx(Ss,{children:Y?e.jsx("div",{className:"task-card dragging",children:t.find(a=>a.id===Y)?.title||"Task"}):null})]}),!i&&!g&&!f&&E>0&&e.jsx(at,{currentPage:O,totalPages:Q,pageSize:ie,total:E,onPageChange:se,onPageSizeChange:xe}),N&&e.jsx("div",{className:"modal-overlay",onClick:ke,children:e.jsxs("div",{className:"modal-content",onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:re?"Edit Task":"Add New Task"}),e.jsx("button",{className:"modal-close",onClick:ke,children:e.jsx(be,{size:20})})]}),e.jsxs("form",{onSubmit:$e,className:"modal-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"title",children:["Title ",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("input",{type:"text",id:"title",name:"title",value:A.title,onChange:Ne,placeholder:"Enter task title",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",name:"description",value:A.description,onChange:Ne,placeholder:"Enter task description",rows:"4"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"priority",children:"Priority"}),e.jsxs("select",{id:"priority",name:"priority",value:A.priority,onChange:Ne,children:[e.jsx("option",{value:"Low",children:"Low"}),e.jsx("option",{value:"Medium",children:"Medium"}),e.jsx("option",{value:"High",children:"High"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"status",children:"Status"}),e.jsxs("select",{id:"status",name:"status",value:A.status,onChange:Ne,children:[e.jsx("option",{value:"To Do",children:"To Do"}),e.jsx("option",{value:"In Progress",children:"In Progress"}),e.jsx("option",{value:"Completed",children:"Completed"})]})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"due_date",children:"Due Date"}),e.jsx("input",{type:"date",id:"due_date",name:"due_date",value:A.due_date,onChange:Ne})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"assigned_to",children:"Assigned To"}),e.jsx("input",{type:"text",id:"assigned_to",name:"assigned_to",value:A.assigned_to,onChange:Ne,placeholder:"Enter assignee name"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"related_to",children:"Related To"}),e.jsx("input",{type:"text",id:"related_to",name:"related_to",value:A.related_to,onChange:Ne,placeholder:"e.g., Account or Opportunity"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"contact_id",children:"Contact ID"}),e.jsx("input",{type:"number",id:"contact_id",name:"contact_id",value:A.contact_id,onChange:Ne,placeholder:"Enter contact ID"})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx(C,{type:"button",variant:"secondary",onClick:ke,children:"Cancel"}),e.jsx(C,{type:"submit",disabled:G,children:G?re?"Updating...":"Creating...":re?"Update Task":"Create Task"})]})]})]})}),oe&&e.jsx("div",{className:"modal-overlay",onClick:ve,children:e.jsxs("div",{className:"modal-content delete-modal",onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"Delete Task"}),e.jsx("button",{className:"modal-close",onClick:ve,children:e.jsx(be,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsx("p",{children:"Are you sure you want to delete this task?"}),e.jsx("p",{style:{fontWeight:600,marginTop:"12px"},children:le?.title||le?.subject}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"14px",marginTop:"8px"},children:"This action cannot be undone."})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx(C,{type:"button",variant:"secondary",onClick:ve,children:"Cancel"}),e.jsx(C,{type:"button",onClick:fe,disabled:G,style:{background:"var(--danger-color)",borderColor:"var(--danger-color)"},children:G?"Deleting...":"Delete"})]})]})}),e.jsx(st,{isOpen:U,onClose:()=>R(!1),onUpload:De,onDownloadTemplate:Oe,onGetProgress:Fe,title:"Upload Tasks from Excel",entityName:"tasks"}),e.jsx(mt,{isOpen:$,onClose:()=>v(!1),onApply:pe,filters:x,filterConfigs:Le})]})},na=()=>{const[t,n]=s.useState(new Date),[i,k]=s.useState(new Date),[f,p]=s.useState([]),[g,j]=s.useState(!0),[N,V]=s.useState(!1),[U,R]=s.useState(null),[$,v]=s.useState(!1),[x,_]=s.useState(!1),[G,T]=s.useState(!1),[O,X]=s.useState(null),[ie,d]=s.useState(null),[Q,F]=s.useState(null),[E,W]=s.useState(1),[te,I]=s.useState(20),[y,L]=s.useState(0),[H,M]=s.useState(0),[Y,Z]=s.useState(""),[re,z]=s.useState(""),[oe,ee]=s.useState(null),[le,u]=s.useState(!1),[A,we]=s.useState({event_type:"",status:"",start_date:"",end_date:""}),[ae,w]=s.useState({title:"",description:"",event_type:"Meeting",start_time:"",end_time:"",location:"",attendees:"",status:"Scheduled"}),[ne,D]=s.useState({}),[ce,se]=s.useState(!1);s.useEffect(()=>{xe()},[E,te,Y,i,A]),s.useEffect(()=>()=>{oe&&clearTimeout(oe)},[oe]);const xe=async()=>{try{f.length===0&&!Y&&!i?j(!0):V(!0),R(null);const o={page:E,page_size:te};if(Y&&(o.search=Y),A.event_type&&(o.event_type=A.event_type),A.status&&(o.status=A.status),i){const ye=i.getFullYear(),m=String(i.getMonth()+1).padStart(2,"0"),me=String(i.getDate()).padStart(2,"0"),Se=`${ye}-${m}-${me}`;o.start_date=Se,o.end_date=Se}else A.start_date&&(o.start_date=A.start_date),A.end_date&&(o.end_date=A.end_date);const K=await Ze.getAll(o);p(K.items||[]),L(K.total_pages||0),M(K.total||0)}catch(o){console.error("Error fetching calendar events:",o),R("Failed to load events. Please try again.")}finally{j(!1),V(!1)}},de=o=>{W(o)},ze=o=>{I(o),W(1)},q=o=>{const K=o.target.value;z(K),oe&&clearTimeout(oe);const ye=setTimeout(()=>{Z(K),E!==1&&W(1)},500);ee(ye)},je=o=>{o.preventDefault(),oe&&clearTimeout(oe),Z(re),E!==1&&W(1)},Ne=()=>{z(""),Z(""),E!==1&&W(1),oe&&clearTimeout(oe)},$e=o=>{const{name:K,value:ye}=o.target;we(m=>({...m,[K]:ye})),E!==1&&W(1)},ke=()=>{we({event_type:"",status:"",start_date:"",end_date:""}),E!==1&&W(1)},Ae=()=>A.event_type||A.status||A.start_date||A.end_date,Ee=o=>{const{name:K,value:ye}=o.target;w(m=>({...m,[K]:ye})),ne[K]&&D(m=>({...m,[K]:""}))},Pe=()=>{const o={};return ae.title.trim()||(o.title="Title is required"),ae.start_time.trim()||(o.start_time="Start time is required"),o},_e=async o=>{o.preventDefault();const K=Pe();if(Object.keys(K).length>0){D(K);return}try{se(!0),O?await Ze.update(O.id,ae):await Ze.create(ae),await xe(),v(!1),X(null),fe()}catch(ye){console.error("Error saving calendar event:",ye),D({submit:ye.message||"Failed to save event. Please try again."})}finally{se(!1)}},fe=()=>{w({title:"",description:"",event_type:"Meeting",start_time:"",end_time:"",location:"",attendees:"",status:"Scheduled"}),D({})},ve=()=>{fe(),X(null),v(!0)},De=o=>{X(o),w({title:o.title||"",description:o.description||"",event_type:o.event_type||"Meeting",start_time:o.start_time?o.start_time.slice(0,16):"",end_time:o.end_time?o.end_time.slice(0,16):"",location:o.location||"",attendees:o.attendees||"",status:o.status||"Scheduled"}),D({}),v(!0)},Fe=()=>{v(!1),X(null),fe()},Oe=o=>{F(o),T(!0)},pe=()=>{T(!1),F(null)},ge=async()=>{if(Q)try{se(!0),await Ze.delete(Q.id),await xe(),T(!1),F(null)}catch(o){console.error("Error deleting calendar event:",o),alert("Failed to delete event. Please try again.")}finally{se(!1)}},Ce=async(o,K=!1)=>{try{const ye=await Ze.bulkUpload(o,K);return ye.async||await xe(),ye}catch(ye){throw console.error("Error uploading Excel file:",ye),ye}},Le=async o=>{try{const K=await Ze.getUploadProgress(o);return K.status==="completed"&&await xe(),K}catch(K){throw console.error("Error getting upload progress:",K),K}},a=async()=>{try{await Ze.downloadTemplate()}catch(o){throw console.error("Error downloading template:",o),o}},r=o=>{const K=o.getFullYear(),ye=o.getMonth(),m=new Date(K,ye,1),Se=new Date(K,ye+1,0).getDate(),Re=m.getDay();return{daysInMonth:Se,startingDayOfWeek:Re}},{daysInMonth:P,startingDayOfWeek:J}=r(t),ue=["January","February","March","April","May","June","July","August","September","October","November","December"],Te=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],Ue=()=>{n(new Date(t.getFullYear(),t.getMonth()-1))},h=()=>{n(new Date(t.getFullYear(),t.getMonth()+1))},l=o=>{const K=new Date(t.getFullYear(),t.getMonth(),o);k(K),E!==1&&W(1)},S=()=>{k(null),E!==1&&W(1)},c=()=>{const o=new Date;k(o),n(new Date(o.getFullYear(),o.getMonth(),1)),E!==1&&W(1)},B={Meeting:"#3b82f6",Call:"#10b981",Task:"#f59e0b",Event:"#8b5cf6"};return e.jsxs("div",{className:"calendar-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"page-title",children:"Calendar"}),e.jsx("p",{className:"page-subtitle",children:"Schedule and manage your meetings and activities"})]}),e.jsxs("div",{style:{display:"flex",gap:"12px"},children:[e.jsx(C,{icon:e.jsx(qe,{size:18}),onClick:()=>_(!0),variant:"outline",children:"Upload Excel"}),e.jsx(C,{icon:e.jsx(tt,{size:18}),onClick:ve,children:"Add Events"})]})]}),e.jsx("div",{style:{marginBottom:"1rem"},children:e.jsxs("form",{onSubmit:je,style:{display:"flex",gap:"8px",maxWidth:"600px"},children:[e.jsx("input",{type:"text",placeholder:"Search events...",className:"search-input-compact",value:re,onChange:q,style:{flex:1}}),re&&e.jsx(C,{type:"button",variant:"outline",onClick:Ne,style:{padding:"0 12px"},children:e.jsx(be,{size:18})}),e.jsx(C,{type:"submit",variant:"outline",disabled:N,children:N?"Searching...":"Search"}),e.jsxs(C,{type:"button",variant:"outline",onClick:()=>u(!le),icon:e.jsx(ot,{size:18}),style:{background:Ae()?"var(--primary-color)":"transparent",color:Ae()?"white":"var(--text-primary)",borderColor:Ae()?"var(--primary-color)":"var(--border-color)"},children:["Filters ",Ae()&&`(${Object.values(A).filter(o=>o).length})`]})]})}),le&&e.jsxs(he,{style:{marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[e.jsx("h3",{style:{margin:0,fontSize:"16px",fontWeight:600},children:"Filter Events"}),Ae()&&e.jsx(C,{variant:"outline",onClick:ke,icon:e.jsx(Fs,{size:16}),style:{padding:"6px 12px",fontSize:"13px"},children:"Clear All"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"16px"},children:[e.jsxs("div",{className:"form-group",style:{margin:0},children:[e.jsx("label",{htmlFor:"filter-event-type",style:{fontSize:"13px",marginBottom:"6px",display:"block"},children:"Event Type"}),e.jsxs("select",{id:"filter-event-type",name:"event_type",value:A.event_type,onChange:$e,style:{width:"100%"},children:[e.jsx("option",{value:"",children:"All Types"}),e.jsx("option",{value:"Meeting",children:"Meeting"}),e.jsx("option",{value:"Call",children:"Call"}),e.jsx("option",{value:"Demo",children:"Demo"}),e.jsx("option",{value:"Conference",children:"Conference"}),e.jsx("option",{value:"Other",children:"Other"})]})]}),e.jsxs("div",{className:"form-group",style:{margin:0},children:[e.jsx("label",{htmlFor:"filter-status",style:{fontSize:"13px",marginBottom:"6px",display:"block"},children:"Status"}),e.jsxs("select",{id:"filter-status",name:"status",value:A.status,onChange:$e,style:{width:"100%"},children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"Scheduled",children:"Scheduled"}),e.jsx("option",{value:"Rescheduled",children:"Rescheduled"}),e.jsx("option",{value:"Completed",children:"Completed"}),e.jsx("option",{value:"Cancelled",children:"Cancelled"})]})]}),e.jsxs("div",{className:"form-group",style:{margin:0},children:[e.jsx("label",{htmlFor:"filter-start-date",style:{fontSize:"13px",marginBottom:"6px",display:"block"},children:"From Date"}),e.jsx("input",{type:"date",id:"filter-start-date",name:"start_date",value:A.start_date,onChange:$e,style:{width:"100%"}})]}),e.jsxs("div",{className:"form-group",style:{margin:0},children:[e.jsx("label",{htmlFor:"filter-end-date",style:{fontSize:"13px",marginBottom:"6px",display:"block"},children:"To Date"}),e.jsx("input",{type:"date",id:"filter-end-date",name:"end_date",value:A.end_date,onChange:$e,style:{width:"100%"}})]})]})]}),g?e.jsx(Ws,{}):U?e.jsx(he,{children:e.jsxs("div",{className:"error-state-container",children:[e.jsx("div",{className:"error-state-message",children:U}),e.jsx(C,{onClick:xe,className:"error-state-retry-button",children:"Retry"})]})}):e.jsxs("div",{className:"calendar-layout",children:[e.jsxs(he,{title:"Calendar View",className:"calendar-card",children:[e.jsxs("div",{className:"calendar-controls",children:[e.jsx("button",{className:"nav-btn",onClick:Ue,children:e.jsx(_t,{size:20})}),e.jsxs("h2",{className:"calendar-month",children:[ue[t.getMonth()]," ",t.getFullYear()]}),e.jsx("button",{className:"nav-btn",onClick:h,children:e.jsx(vt,{size:20})})]}),e.jsxs("div",{className:"calendar-grid",children:[Te.map(o=>e.jsx("div",{className:"calendar-day-header",children:o},o)),[...Array(J)].map((o,K)=>e.jsx("div",{className:"calendar-day empty"},`empty-${K}`)),[...Array(P)].map((o,K)=>{const ye=K+1,m=ye===new Date().getDate()&&t.getMonth()===new Date().getMonth()&&t.getFullYear()===new Date().getFullYear(),me=i&&ye===i.getDate()&&t.getMonth()===i.getMonth()&&t.getFullYear()===i.getFullYear();return e.jsx("div",{className:`calendar-day ${m?"today":""} ${me?"selected":""}`,onClick:()=>l(ye),children:e.jsx("span",{className:"day-number",children:ye})},ye)})]})]}),e.jsx(he,{title:i?`Events on ${i.getDate().toString().padStart(2,"0")}/${(i.getMonth()+1).toString().padStart(2,"0")}/${i.getFullYear()}`:"All Upcoming Events",action:e.jsx("button",{onClick:i?S:c,style:{padding:"6px 12px",fontSize:"13px",background:i?"var(--background)":"var(--primary-color)",border:i?"1px solid var(--border-color)":"1px solid var(--primary-color)",borderRadius:"6px",cursor:"pointer",color:i?"var(--text-secondary)":"white",transition:"all 0.2s"},onMouseEnter:o=>{i?(o.target.style.background="var(--surface)",o.target.style.color="var(--primary-color)"):o.target.style.background="#2563eb"},onMouseLeave:o=>{i?(o.target.style.background="var(--background)",o.target.style.color="var(--text-secondary)"):o.target.style.background="var(--primary-color)"},children:i?"View All":"Today"}),className:"events-card",children:N?e.jsxs("div",{style:{padding:"2rem",textAlign:"center",color:"#64748b"},children:[e.jsx(Xe,{}),e.jsx("div",{style:{marginTop:"8px"},children:"Searching..."})]}):f.length===0?e.jsx("div",{style:{padding:"1rem",textAlign:"center",color:"#64748b"},children:Y?"No events found matching your search.":i?"No events scheduled for this date.":"No upcoming events"}):e.jsx("div",{className:"events-list",children:f.map(o=>e.jsxs("div",{className:"event-item",children:[e.jsx("div",{className:"event-indicator",style:{background:B[o.event_type||o.type]||"#8b5cf6"}}),e.jsxs("div",{className:"event-details",children:[e.jsx("h4",{className:"event-title",children:o.title||o.subject}),e.jsxs("div",{className:"event-meta",children:[e.jsx("span",{className:"event-date",children:o.start_time?(()=>{const K=new Date(o.start_time);return`${K.getDate().toString().padStart(2,"0")}/${(K.getMonth()+1).toString().padStart(2,"0")}/${K.getFullYear()}`})():"N/A"}),e.jsx("span",{className:"event-time",children:o.start_time?new Date(o.start_time).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"All day"}),e.jsx("span",{className:"event-type",style:{background:`${B[o.event_type||o.type]||"#8b5cf6"}20`,color:B[o.event_type||o.type]||"#8b5cf6"},children:o.event_type||o.type||"Event"})]}),o.description&&e.jsx("p",{className:"event-description",children:o.description}),o.location&&e.jsxs("p",{className:"event-location",children:["📍 ",o.location]})]}),e.jsxs("div",{className:"event-actions",children:[e.jsx("button",{onClick:()=>De(o),className:"event-action-btn edit-btn",title:"Edit event","aria-label":"Edit event",children:e.jsx(Ut,{size:16})}),e.jsx("button",{onClick:()=>Oe(o),className:"event-action-btn delete-btn",title:"Delete event","aria-label":"Delete event",children:e.jsx(Je,{size:16})})]})]},o.id))})})]}),!g&&!U&&!N&&H>0&&e.jsx(at,{currentPage:E,totalPages:y,pageSize:te,total:H,onPageChange:de,onPageSizeChange:ze}),$&&e.jsx("div",{className:"modal-overlay",onClick:Fe,children:e.jsxs("div",{className:"modal-content",onClick:o=>o.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:O?"Edit Calendar Event":"Add New Calendar Event"}),e.jsx("button",{className:"modal-close",onClick:Fe,children:e.jsx(be,{size:24})})]}),e.jsxs("form",{onSubmit:_e,className:"modal-form",children:[e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group full-width",children:[e.jsxs("label",{htmlFor:"title",children:["Title ",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("input",{type:"text",id:"title",name:"title",value:ae.title,onChange:Ee,className:ne.title?"error":"",placeholder:"Enter event title"}),ne.title&&e.jsx("span",{className:"error-text",children:ne.title})]}),e.jsxs("div",{className:"form-group full-width",children:[e.jsx("label",{htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",name:"description",value:ae.description,onChange:Ee,placeholder:"Enter event description",rows:"3"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"event_type",children:"Event Type"}),e.jsxs("select",{id:"event_type",name:"event_type",value:ae.event_type,onChange:Ee,children:[e.jsx("option",{value:"Meeting",children:"Meeting"}),e.jsx("option",{value:"Call",children:"Call"}),e.jsx("option",{value:"Task",children:"Task"}),e.jsx("option",{value:"Event",children:"Event"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"status",children:"Status"}),e.jsxs("select",{id:"status",name:"status",value:ae.status,onChange:Ee,children:[e.jsx("option",{value:"Scheduled",children:"Scheduled"}),e.jsx("option",{value:"In Progress",children:"In Progress"}),e.jsx("option",{value:"Completed",children:"Completed"}),e.jsx("option",{value:"Cancelled",children:"Cancelled"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"start_time",children:["Start Time ",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("input",{type:"datetime-local",id:"start_time",name:"start_time",value:ae.start_time,onChange:Ee,className:ne.start_time?"error":""}),ne.start_time&&e.jsx("span",{className:"error-text",children:ne.start_time})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"end_time",children:"End Time"}),e.jsx("input",{type:"datetime-local",id:"end_time",name:"end_time",value:ae.end_time,onChange:Ee})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"location",children:"Location"}),e.jsx("input",{type:"text",id:"location",name:"location",value:ae.location,onChange:Ee,placeholder:"Enter location or meeting link"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"attendees",children:"Attendees"}),e.jsx("input",{type:"text",id:"attendees",name:"attendees",value:ae.attendees,onChange:Ee,placeholder:"Comma-separated emails or names"})]})]}),ne.submit&&e.jsx("div",{className:"error-message",children:ne.submit}),e.jsxs("div",{className:"modal-actions",children:[e.jsx(C,{type:"button",variant:"outline",onClick:Fe,children:"Cancel"}),e.jsx(C,{type:"submit",disabled:ce,children:ce?O?"Updating...":"Creating...":O?"Update Event":"Create Event"})]})]})]})}),e.jsx(st,{isOpen:x,onClose:()=>_(!1),onUpload:Ce,onDownloadTemplate:a,onGetProgress:Le,title:"Upload Calendar Events from Excel",entityName:"calendar events"}),G&&e.jsx("div",{className:"modal-overlay",onClick:pe,children:e.jsxs("div",{className:"modal-content delete-modal",onClick:o=>o.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"Delete Event"}),e.jsx("button",{className:"modal-close",onClick:pe,children:e.jsx(be,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsx("p",{children:"Are you sure you want to delete this event?"}),e.jsx("p",{style:{fontWeight:600,marginTop:"12px"},children:Q?.title}),Q?.start_time&&e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"14px",marginTop:"4px"},children:(()=>{const o=new Date(Q.start_time);return`${o.getDate().toString().padStart(2,"0")}/${(o.getMonth()+1).toString().padStart(2,"0")}/${o.getFullYear()} at ${o.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}`})()}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"14px",marginTop:"12px"},children:"This action cannot be undone."})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx(C,{type:"button",variant:"outline",onClick:pe,children:"Cancel"}),e.jsx(C,{type:"button",onClick:ge,disabled:ce,style:{background:"#ef4444",borderColor:"#ef4444"},children:ce?"Deleting...":"Delete Event"})]})]})})]})},la=()=>{const[t,n]=s.useState(!0),[i,k]=s.useState(null),[f,p]=s.useState(null),[g,j]=s.useState(null),[N,V]=s.useState(!1),U=s.useRef(null);s.useEffect(()=>{R()},[]);const R=async()=>{try{n(!0),k(null);const[T,O]=await Promise.all([wt.getStats(),Rs.analytics({months:6})]);p(T),j(O)}catch(T){console.error("Error fetching report data:",T),k("Failed to load reports. Please try again.")}finally{n(!1)}},$=async()=>{try{V(!0);const T=U.current;if(!T)throw new Error("Reports content not found");const O=document.createElement("div");O.style.position="absolute",O.style.left="-9999px",O.style.top="0",O.style.width="1200px",O.style.background="white",O.style.padding="40px",document.body.appendChild(O);const X=T.cloneNode(!0);O.appendChild(X),await new Promise(H=>setTimeout(H,500));const ie=await Ts(O,{scale:2,useCORS:!0,logging:!1,backgroundColor:"#ffffff"});document.body.removeChild(O);const d=210,Q=297,F=ie.height*d/ie.width;let E=F,W=0;const te=new Ps("p","mm","a4"),I=ie.toDataURL("image/png");for(te.addImage(I,"PNG",0,W,d,F),E-=Q;E>0;)W=E-F,te.addPage(),te.addImage(I,"PNG",0,W,d,F),E-=Q;const L=`CRM_Reports_${new Date().toISOString().split("T")[0]}.pdf`;te.save(L)}catch(T){console.error("Error exporting PDF:",T),alert("Failed to export PDF. Please try again.")}finally{V(!1)}},v=g?.salesByRep||[],x=g?.conversionFunnel||[],_=g?.monthlyTrends||[],G=(g?.leadSourceData||[]).map((T,O)=>({...T,color:["#3b82f6","#10b981","#8b5cf6","#f59e0b","#64748b"][O%5]}));return e.jsxs("div",{className:"reports-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"page-title",children:"Reports & Analytics"}),e.jsx("p",{className:"page-subtitle",children:"Track performance metrics and gain insights into your sales activities"})]}),e.jsx("div",{className:"page-actions",children:e.jsx(C,{onClick:$,disabled:t||N,variant:"primary",children:N?"Exporting...":"📄 Export PDF"})})]}),t?e.jsx(Qs,{}):i?e.jsx(he,{children:e.jsxs("div",{className:"error-state-container",children:[e.jsx("div",{className:"error-state-message",children:i}),e.jsx(C,{onClick:R,className:"error-state-retry-button",children:"Retry"})]})}):e.jsx("div",{ref:U,children:e.jsxs("div",{className:"reports-grid",children:[e.jsx(he,{title:"Sales Performance by Representative",className:"report-card",children:e.jsx(nt,{width:"100%",height:300,children:e.jsxs(Pt,{data:v,children:[e.jsx(pt,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),e.jsx(xt,{dataKey:"name",stroke:"#64748b"}),e.jsx(gt,{stroke:"#64748b"}),e.jsx(lt,{contentStyle:{background:"#fff",border:"1px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"}}),e.jsx(St,{}),e.jsx(Nt,{dataKey:"deals",fill:"#3b82f6",name:"Deals Closed"}),e.jsx(Nt,{dataKey:"revenue",fill:"#10b981",name:"Revenue ($)"})]})})}),e.jsx(he,{title:"Lead Sources Distribution",className:"report-card",children:e.jsx(nt,{width:"100%",height:300,children:e.jsxs(Mt,{children:[e.jsx(It,{data:G,cx:"50%",cy:"50%",labelLine:!1,label:({name:T,percent:O})=>`${T}: ${(O*100).toFixed(0)}%`,outerRadius:100,fill:"#8884d8",dataKey:"value",children:G.map((T,O)=>e.jsx(qt,{fill:T.color},`cell-${O}`))}),e.jsx(lt,{})]})})}),e.jsx(he,{title:"Conversion Funnel",className:"report-card full-width",children:e.jsx(nt,{width:"100%",height:300,children:e.jsxs(Pt,{data:x,layout:"vertical",children:[e.jsx(pt,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),e.jsx(xt,{type:"number",stroke:"#64748b"}),e.jsx(gt,{dataKey:"stage",type:"category",stroke:"#64748b"}),e.jsx(lt,{contentStyle:{background:"#fff",border:"1px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"}}),e.jsx(Nt,{dataKey:"count",fill:"#8b5cf6",name:"Count"})]})})}),e.jsx(he,{title:"6-Month Performance Trends",className:"report-card full-width",children:e.jsx(nt,{width:"100%",height:300,children:e.jsxs(Rt,{data:_,children:[e.jsx(pt,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),e.jsx(xt,{dataKey:"month",stroke:"#64748b"}),e.jsx(gt,{stroke:"#64748b"}),e.jsx(lt,{contentStyle:{background:"#fff",border:"1px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"}}),e.jsx(St,{}),e.jsx(ft,{type:"monotone",dataKey:"newLeads",stroke:"#3b82f6",strokeWidth:2,name:"New Leads"}),e.jsx(ft,{type:"monotone",dataKey:"closedDeals",stroke:"#10b981",strokeWidth:2,name:"Closed Deals"})]})})})]})})]})},ra=()=>{const[t,n]=s.useState([]),[i,k]=s.useState(!0),[f,p]=s.useState(null),[g,j]=s.useState(null),[N,V]=s.useState(null);s.useEffect(()=>{U()},[]);const U=async()=>{try{k(!0),p(null);const d=await Ie.getAll({page_size:100}),Q=d?.items||d||[];n(Array.isArray(Q)?Q:[])}catch(d){console.error("Error fetching opportunities:",d),p("Failed to load pipeline. Please try again.")}finally{k(!1)}},$=["Prospecting","Qualification","Proposal","Negotiation","Closed Won"].map(d=>{const F=(Array.isArray(t)?t:[]).filter(E=>E?.stage===d).map(E=>({id:E.id,company:E.account||"Unknown",value:typeof E.value=="number"?`$${E.value.toLocaleString()}`:String(E.value||"0"),probability:E.probability||0,amount:typeof E.value=="number"?E.value:parseFloat(String(E.value||"0").replace(/[$,]/g,""))||0}));return{name:d,deals:F}}),v=d=>d.reduce((Q,F)=>Q+F.amount,0).toLocaleString(),x=d=>Math.round(d.reduce((Q,F)=>Q+F.amount*F.probability/100,0)).toLocaleString(),_=(d,Q,F)=>{j({...Q,currentStage:F}),d.dataTransfer.effectAllowed="move",d.currentTarget.classList.add("dragging")},G=d=>{d.currentTarget.classList.remove("dragging"),j(null),V(null)},T=d=>{d.preventDefault(),d.dataTransfer.dropEffect="move"},O=(d,Q)=>{d.preventDefault(),V(Q)},X=d=>{d.currentTarget===d.target&&V(null)},ie=async(d,Q)=>{if(d.preventDefault(),V(null),!g||g.currentStage===Q)return;const F=g.currentStage;n(E=>E.map(W=>W.id===g.id?{...W,stage:Q}:W));try{await Ie.update(g.id,{stage:Q})}catch(E){console.error("Error updating opportunity stage:",E),n(W=>W.map(te=>te.id===g.id?{...te,stage:F}:te)),p("Failed to update opportunity. Please try again."),setTimeout(()=>p(null),3e3)}};return i?e.jsxs("div",{className:"pipeline-page",children:[e.jsx("div",{className:"page-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"page-title",children:"Sales Pipeline"}),e.jsx("p",{className:"page-subtitle",children:"Visualize and manage opportunities across different sales stages"})]})}),e.jsx(Vs,{})]}):f?e.jsxs("div",{className:"pipeline-page",children:[e.jsx("div",{className:"page-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"page-title",children:"Sales Pipeline"}),e.jsx("p",{className:"page-subtitle",children:"Visualize and manage opportunities across different sales stages"})]})}),e.jsx(he,{children:e.jsxs("div",{className:"error-state-container",children:[e.jsx("div",{className:"error-state-message",children:f}),e.jsx(C,{onClick:U,className:"error-state-retry-button",children:"Retry"})]})})]}):e.jsxs("div",{className:"pipeline-page",children:[e.jsx("div",{className:"page-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"page-title",children:"Sales Pipeline"}),e.jsx("p",{className:"page-subtitle",children:"Visualize and manage opportunities across different sales stages"})]})}),i?e.jsx(he,{children:e.jsx(Xe,{text:"Loading pipeline..."})}):f?e.jsx(he,{children:e.jsxs("div",{className:"error-state-container",children:[e.jsx("div",{className:"error-state-message",children:f}),e.jsx(C,{onClick:U,className:"error-state-retry-button",children:"Retry"})]})}):e.jsx("div",{className:"pipeline-view",children:$.map((d,Q)=>e.jsxs("div",{className:`pipeline-stage ${N===d.name?"drag-over":""}`,children:[e.jsxs("div",{className:"stage-header",children:[e.jsx("h3",{className:"stage-name",children:d.name}),e.jsxs("div",{className:"stage-metrics",children:[e.jsxs("div",{className:"stage-count",children:[d.deals.length," deals"]}),e.jsxs("div",{className:"stage-value",children:["$",v(d.deals)]}),e.jsxs("div",{className:"stage-weighted",children:["Weighted: $",x(d.deals)]})]})]}),e.jsx("div",{className:"stage-deals",onDragOver:T,onDragEnter:F=>O(F,d.name),onDragLeave:X,onDrop:F=>ie(F,d.name),children:d.deals.length===0?e.jsx("div",{style:{padding:"1rem",textAlign:"center",color:"#64748b"},children:"No opportunities"}):d.deals.map(F=>e.jsxs("div",{className:"pipeline-deal",draggable:!0,onDragStart:E=>_(E,F,d.name),onDragEnd:G,children:[e.jsx("h4",{className:"deal-company",children:F.company}),e.jsx("div",{className:"deal-value",children:F.value}),e.jsxs("div",{className:"deal-probability",children:[e.jsx("div",{className:"probability-bar-container",children:e.jsx("div",{className:"probability-bar-fill",style:{width:`${F.probability}%`}})}),e.jsxs("span",{className:"probability-text",children:[F.probability,"%"]})]})]},F.id))})]},Q))})]})},At=t=>t>=1e9?(t/1e9).toFixed(1).replace(/\.0$/,"")+"B":t>=1e6?(t/1e6).toFixed(1).replace(/\.0$/,"")+"M":t>=1e3?(t/1e3).toFixed(1).replace(/\.0$/,"")+"K":t.toString(),ia=()=>{const t=dt(),[n,i]=s.useState([]),[k,f]=s.useState(!0),[p,g]=s.useState(!1),[j,N]=s.useState(null),[V,U]=s.useState(!1),[R,$]=s.useState(!1),[v,x]=s.useState(!1),[_,G]=s.useState(null),[T,O]=s.useState(!1),[X,ie]=s.useState(null),[d,Q]=s.useState(!1),[F,E]=s.useState(1),[W,te]=s.useState(20),[I,y]=s.useState(0),[L,H]=s.useState(0),[M,Y]=s.useState(""),[Z,re]=s.useState(""),[z,oe]=s.useState(null),[ee,le]=s.useState({name:"",subject:"",status:"Draft",sent_count:0,open_rate:0,click_rate:0,conversion_rate:0,scheduled_date:""}),[u,A]=s.useState(!1),[we,ae]=s.useState(null),[w,ne]=s.useState({total_campaigns:0,total_sent:0,avg_open_rate:0,avg_click_rate:0,avg_conversion_rate:0});s.useEffect(()=>{D(),se()},[F,W,M]),s.useEffect(()=>()=>{z&&clearTimeout(z)},[z]);const D=async()=>{try{n.length===0&&!M?f(!0):g(!0),N(null);const a={page:F,page_size:W};M&&(a.search=M);const r=await He.getAll(a);i(r.items||[]),y(r.total_pages||0),H(r.total||0)}catch(a){console.error("Error fetching campaigns:",a),N("Failed to load campaigns. Please try again.")}finally{f(!1),g(!1)}},se=async()=>{try{const a=await He.getSummary();ne(a)}catch(a){console.error("Error fetching summary:",a)}},xe=a=>{const r=a.target.value;re(r),z&&clearTimeout(z);const P=setTimeout(()=>{Y(r),F!==1&&E(1)},500);oe(P)},de=a=>{a.preventDefault(),z&&clearTimeout(z),Y(Z),F!==1&&E(1)},ze=()=>{re(""),Y(""),F!==1&&E(1),z&&clearTimeout(z)},q=a=>{E(a)},je=a=>{te(a),E(1)},Ne=async a=>{const r=n.find(P=>P.id===a);G(r),x(!0)},$e=async()=>{if(_){O(!0);try{await He.delete(_.id),i(n.filter(a=>a.id!==_.id)),H(a=>a-1),await se(),x(!1),G(null),t.success("Campaign deleted successfully!")}catch(a){console.error("Error deleting campaign:",a),t.error("Failed to delete campaign. Please try again.")}finally{O(!1)}}},ke=()=>{x(!1),G(null)},Ae=a=>{Q(!0),ie(a),le({name:a.name||"",subject:a.subject||"",status:a.status||"Draft",sent_count:a.sent_count||0,open_rate:a.open_rate||0,click_rate:a.click_rate||0,conversion_rate:a.conversion_rate||0,scheduled_date:a.scheduled_date||""}),U(!0),ae(null)},Ee=()=>{Q(!1),ie(null),U(!0),le({name:"",subject:"",status:"Draft",sent_count:0,open_rate:0,click_rate:0,conversion_rate:0,scheduled_date:""}),ae(null)},Pe=()=>{U(!1),Q(!1),ie(null),le({name:"",subject:"",status:"Draft",sent_count:0,open_rate:0,click_rate:0,conversion_rate:0,scheduled_date:""}),ae(null)},_e=a=>{const{name:r,value:P,type:J}=a.target;le(ue=>({...ue,[r]:J==="number"?parseFloat(P)||0:P}))},fe=async a=>{if(a.preventDefault(),ae(null),!ee.name.trim()){ae("Campaign name is required");return}if(!ee.subject.trim()){ae("Subject is required");return}try{if(A(!0),d&&X){const r=await He.update(X.id,ee);i(n.map(P=>P.id===X.id?{...P,...r}:P)),await se(),t.success("Campaign updated successfully!")}else await He.create(ee),await D(),await se(),t.success("Campaign created successfully!");Pe()}catch(r){console.error(`Error ${d?"updating":"creating"} campaign:`,r),ae(r.message||`Failed to ${d?"update":"create"} campaign`)}finally{A(!1)}},ve=async(a,r=!1)=>{try{const P=await He.bulkUpload(a,r);return P.async||(await D(),await se()),P}catch(P){throw console.error("Error uploading email campaigns:",P),P}},De=async a=>{try{const r=await He.getUploadProgress(a);return r.status==="completed"&&(await D(),await se()),r}catch(r){throw console.error("Error getting upload progress:",r),r}},Fe=async()=>{try{await He.downloadTemplate()}catch(a){throw console.error("Error downloading template:",a),a}},Oe=a=>(a.open_rate||0).toFixed(1),pe=a=>(a.click_rate||0).toFixed(1),ge={Active:"#10b981",Completed:"#64748b",Scheduled:"#3b82f6",Draft:"#f59e0b"},Ce={sent:w.total_sent||0,avgOpenRate:w.avg_open_rate||0,avgClickRate:w.avg_click_rate||0,totalCampaigns:w.total_campaigns||0},Le=Math.round(Ce.sent*(w.avg_conversion_rate||0)/100);return e.jsxs("div",{className:"email-campaigns-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"page-title",children:"Email Campaigns"}),e.jsx("p",{className:"page-subtitle",children:"Create and track email marketing campaigns to engage your leads"})]}),e.jsxs("div",{style:{display:"flex",gap:"0.75rem"},children:[e.jsx(C,{icon:e.jsx(qe,{size:18}),onClick:()=>$(!0),variant:"outline",children:"Upload Excel"}),e.jsx(C,{icon:e.jsx(tt,{size:18}),onClick:Ee,children:"Create Campaign"})]})]}),k?e.jsx(Hs,{}):j?e.jsx(he,{children:e.jsxs("div",{className:"error-state-container",children:[e.jsx("div",{className:"error-state-message",children:j}),e.jsx(C,{onClick:D,className:"error-state-retry-button",children:"Retry"})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"campaign-stats",children:[e.jsxs("div",{className:"stat-card-email",children:[e.jsx("div",{className:"stat-icon-email",style:{background:"#3b82f620",color:"#3b82f6"},children:e.jsx(As,{size:24})}),e.jsxs("div",{className:"stat-info-email",children:[e.jsx("div",{className:"stat-value-email",children:At(Ce.sent)}),e.jsx("div",{className:"stat-label-email",children:"Total Sent"})]})]}),e.jsxs("div",{className:"stat-card-email",children:[e.jsx("div",{className:"stat-icon-email",style:{background:"#10b98120",color:"#10b981"},children:e.jsx(Ye,{size:24})}),e.jsxs("div",{className:"stat-info-email",children:[e.jsx("div",{className:"stat-value-email",children:e.jsx(Be,{value:Ce.avgOpenRate,duration:1200,decimals:1,suffix:"%"})}),e.jsx("div",{className:"stat-label-email",children:"Avg. Open Rate"})]})]}),e.jsxs("div",{className:"stat-card-email",children:[e.jsx("div",{className:"stat-icon-email",style:{background:"#f59e0b20",color:"#f59e0b"},children:e.jsx(et,{size:24})}),e.jsxs("div",{className:"stat-info-email",children:[e.jsx("div",{className:"stat-value-email",children:e.jsx(Be,{value:Ce.avgClickRate,duration:1200,decimals:1,suffix:"%"})}),e.jsx("div",{className:"stat-label-email",children:"Avg. Click Rate"})]})]}),e.jsxs("div",{className:"stat-card-email",children:[e.jsx("div",{className:"stat-icon-email",style:{background:"#8b5cf620",color:"#8b5cf6"},children:e.jsx(et,{size:24})}),e.jsxs("div",{className:"stat-info-email",children:[e.jsx("div",{className:"stat-value-email",children:At(Le)}),e.jsx("div",{className:"stat-label-email",children:"Total Conversions"})]})]})]}),e.jsxs(he,{title:"All Campaigns",children:[e.jsx("div",{style:{marginBottom:"1rem",display:"flex",gap:"8px"},children:e.jsxs("form",{onSubmit:de,style:{flex:1,display:"flex",gap:"8px"},children:[e.jsx("input",{type:"text",placeholder:"Search campaigns...",className:"search-input-compact",value:Z,onChange:xe,style:{flex:1}}),Z&&e.jsx(C,{type:"button",variant:"outline",onClick:ze,style:{padding:"0 12px"},children:e.jsx(be,{size:18})}),e.jsx(C,{type:"submit",variant:"outline",disabled:p,children:p?"Searching...":"Search"})]})}),e.jsx("div",{className:"table-container",children:p?e.jsxs("div",{style:{padding:"2rem",textAlign:"center",color:"#64748b"},children:[e.jsx(Xe,{}),e.jsx("div",{style:{marginTop:"8px"},children:"Searching..."})]}):e.jsxs("table",{className:"data-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Campaign Name"}),e.jsx("th",{children:"Subject"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Sent"}),e.jsx("th",{children:"Open Rate"}),e.jsx("th",{children:"Click Rate"}),e.jsx("th",{children:"Conversions"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:n.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"9",style:{textAlign:"center",padding:"2rem"},children:M?"No campaigns found matching your search.":'No campaigns found. Click "Create Campaign" to create one.'})}):n.map(a=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-semibold",children:a.name}),e.jsx("td",{children:a.subject}),e.jsx("td",{children:e.jsx("span",{className:"campaign-status",style:{background:`${ge[a.status]||"#64748b"}20`,color:ge[a.status]||"#64748b"},children:a.status})}),e.jsx("td",{children:(a.sent_count||0).toLocaleString()}),e.jsx("td",{children:e.jsxs("div",{className:"rate-cell",children:[e.jsx("div",{className:"rate-bar-bg",children:e.jsx("div",{className:"rate-bar",style:{width:`${Oe(a)}%`,background:"#10b981"}})}),e.jsxs("span",{children:[Oe(a),"%"]})]})}),e.jsx("td",{children:e.jsxs("div",{className:"rate-cell",children:[e.jsx("div",{className:"rate-bar-bg",children:e.jsx("div",{className:"rate-bar",style:{width:`${pe(a)}%`,background:"#3b82f6"}})}),e.jsxs("span",{children:[pe(a),"%"]})]})}),e.jsx("td",{className:"font-semibold",children:Math.round((a.sent_count||0)*(a.conversion_rate||0)/100)}),e.jsx("td",{children:a.created_at?new Date(a.created_at).toLocaleDateString():"N/A"}),e.jsx("td",{children:e.jsxs("div",{className:"table-actions",children:[e.jsx("button",{className:"action-btn",onClick:()=>Ae(a),title:"Edit",children:e.jsx(it,{size:16})}),e.jsx("button",{className:"action-btn danger",onClick:()=>Ne(a.id),title:"Delete",disabled:T&&_?.id===a.id,children:e.jsx(Je,{size:16})})]})})]},a.id))})]})}),!k&&!j&&!p&&L>0&&e.jsx(at,{currentPage:F,totalPages:I,pageSize:W,total:L,onPageChange:q,onPageSizeChange:je})]})]}),V&&e.jsx("div",{className:"modal-overlay",onClick:Pe,children:e.jsxs("div",{className:"modal-content",onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:d?"Edit Campaign":"Create New Campaign"}),e.jsx("button",{className:"modal-close",onClick:Pe,children:e.jsx(be,{size:20})})]}),e.jsxs("form",{onSubmit:fe,children:[e.jsxs("div",{className:"modal-body",children:[we&&e.jsx("div",{className:"form-error",children:we}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"name",children:"Campaign Name *"}),e.jsx("input",{type:"text",id:"name",name:"name",value:ee.name,onChange:_e,placeholder:"Enter campaign name",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"subject",children:"Email Subject *"}),e.jsx("input",{type:"text",id:"subject",name:"subject",value:ee.subject,onChange:_e,placeholder:"Enter email subject",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"status",children:"Status"}),e.jsxs("select",{id:"status",name:"status",value:ee.status,onChange:_e,children:[e.jsx("option",{value:"Draft",children:"Draft"}),e.jsx("option",{value:"Scheduled",children:"Scheduled"}),e.jsx("option",{value:"Active",children:"Active"}),e.jsx("option",{value:"Completed",children:"Completed"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"scheduled_date",children:"Scheduled Date"}),e.jsx("input",{type:"datetime-local",id:"scheduled_date",name:"scheduled_date",value:ee.scheduled_date,onChange:_e})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"sent_count",children:"Sent Count"}),e.jsx("input",{type:"number",id:"sent_count",name:"sent_count",value:ee.sent_count,onChange:_e,min:"0"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"open_rate",children:"Open Rate (%)"}),e.jsx("input",{type:"number",id:"open_rate",name:"open_rate",value:ee.open_rate,onChange:_e,min:"0",max:"100",step:"0.1"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"click_rate",children:"Click Rate (%)"}),e.jsx("input",{type:"number",id:"click_rate",name:"click_rate",value:ee.click_rate,onChange:_e,min:"0",max:"100",step:"0.1"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"conversion_rate",children:"Conversion Rate (%)"}),e.jsx("input",{type:"number",id:"conversion_rate",name:"conversion_rate",value:ee.conversion_rate,onChange:_e,min:"0",max:"100",step:"0.1"})]})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx(C,{type:"button",onClick:Pe,style:{background:"#64748b"},children:"Cancel"}),e.jsx(C,{type:"submit",disabled:u,children:u?d?"Updating...":"Creating...":d?"Update Campaign":"Create Campaign"})]})]})]})}),R&&e.jsx(st,{isOpen:R,onClose:()=>$(!1),onUpload:ve,onDownloadTemplate:Fe,onGetProgress:De,title:"Upload Email Campaigns from Excel",entityName:"campaigns"}),v&&_&&e.jsx(ut,{isOpen:v,onClose:ke,onConfirm:$e,title:"Delete Campaign",message:`Are you sure you want to delete the campaign "${_.name}"? This action cannot be undone.`,confirmText:"Delete Campaign",cancelText:"Cancel",type:"danger",loading:T})]})};function oa(){const[t,n]=s.useState(!1);return e.jsx(zs,{children:e.jsx(Vt,{children:e.jsxs("div",{className:"app",children:[e.jsx(Is,{collapsed:t,setCollapsed:n}),e.jsxs("div",{className:`main-content ${t?"sidebar-collapsed":""}`,children:[e.jsx(qs,{}),e.jsx("div",{className:"page-content",children:e.jsxs(Qt,{children:[e.jsx(Me,{path:"/",element:e.jsx(Ks,{})}),e.jsx(Me,{path:"/contacts",element:e.jsx(Ys,{})}),e.jsx(Me,{path:"/leads",element:e.jsx(Xs,{})}),e.jsx(Me,{path:"/opportunities",element:e.jsx(Zs,{})}),e.jsx(Me,{path:"/accounts",element:e.jsx(ea,{})}),e.jsx(Me,{path:"/tasks",element:e.jsx(aa,{})}),e.jsx(Me,{path:"/calendar",element:e.jsx(na,{})}),e.jsx(Me,{path:"/reports",element:e.jsx(la,{})}),e.jsx(Me,{path:"/pipeline",element:e.jsx(ra,{})}),e.jsx(Me,{path:"/email-campaigns",element:e.jsx(ia,{})})]})})]})]})})})}Gt.createRoot(document.getElementById("root")).render(e.jsx(zt.StrictMode,{children:e.jsx(oa,{})}));
